var app=angular.module("de.cismet.uim2020-html5-demonstrator",["de.cismet.uim2020-html5-demonstrator.controllers","de.cismet.uim2020-html5-demonstrator.directives","de.cismet.uim2020-html5-demonstrator.services","de.cismet.uim2020-html5-demonstrator.filters","ngResource","ngAnimate","ngSanitize","ui.bootstrap","ui.bootstrap.modal","ui.router","ui.router.modal","ct.ui.router.extras.sticky","ct.ui.router.extras.dsr","ct.ui.router.extras.previous","leaflet-directive","ngTable","mgo-angular-wizard"]);app.config(["$logProvider","$stateProvider","$urlRouterProvider",function(a,b,c){"use strict";a.debugEnabled(!1);var d;d=function(a){return console.log("resolve entity "+a.id+"@"+a["class"]),{"class":a["class"],id:a.id}},c.otherwise("/search/map"),b.state("main",{"abstract":!0,sticky:!0,url:"",views:{main:{templateUrl:"views/main.html",controller:"mainController",controllerAs:"mainController"}},deepStateRedirect:{"default":{state:"main.search"}}}),b.state("main.authentication",{url:"login",data:{roles:["User"]},views:{"authentication@main":{templateUrl:"views/authentication/login.html",controller:"authenticationController",controllerAs:"authenticationController"}}}),b.state("main.search",{url:"/search",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.search.map",params:{zoom:"15"}}},views:{"search@main":{templateUrl:"views/search/index.html",controller:"searchController",controllerAs:"searchController"},"search-toolbar@main.search":{templateUrl:"views/search/toolbar.html",controller:["$scope",function(a){console.log("main.search.toolbar instance created"),a.name="main.search.toolbar",this.name="this.main.search.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.search.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},sticky:!0,views:{"search-map@main.search":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}}}),b.state("main.search.list",{url:"/list",data:{roles:["User"]},sticky:!0,views:{"search-list@main.search":{templateUrl:"views/search/list.html",controller:"listController",controllerAs:"listController"}}}),b.state("main.analysis",{url:"/analysis",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.analysis.map",params:{zoom:"14"}}},views:{"analysis@main":{templateUrl:"views/analysis/index.html",controller:"analysisController",controllerAs:"analysisController"},"analysis-toolbar@main.analysis":{templateUrl:"views/analysis/toolbar.html",controller:["$scope",function(a){console.log("main.analysis.toolbar instance created"),a.name="main.analysis.toolbar",this.name="this.main.analysis.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.analysis.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},views:{"analysis-map@main.analysis":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}},onEnter:function(){},onExit:function(){}}),b.state("main.protocol",{url:"/protocol",data:{roles:["User"]},sticky:!0,deepStateRedirect:!0,templateUrl:"views/protocol/index.html",controller:["$scope",function(a){console.log("main.protocol created"),a.name="main.protocol",this.name="this.main.protocol"}],controllerAs:"protocolController",views:{"protocol@main":{templateUrl:"views/protocol/index.html"}}}),b.state("modal",{"abstract":!0}),b.state("modal.entity",{url:"/entity/{class:string}/{id:int}",data:{roles:["User"]},sticky:!1,backdrop:"static",templateUrl:"views/entity/modal.html",controller:"entityController",controllerAs:"entityController",modal:!0,resolve:{entity:["$stateParams",d],entityModalInvoker:["$previousState",function(a){return a.memo("entityModalInvoker"),a.get("entityModalInvoker")}]}})}]),app.run(["$rootScope","$state","$stateParams","$previousState","authenticationService",function(a,b,c,d,e){"use strict";a.$state=b,a.$stateParams=c,a.$on("$stateChangeStart",function(a,c,f,g,h){"main.authentication"!==c.name?(e.isIdentityResolved()||e.getIdentity())&&e.isAuthenticated()?""===g.name&&"modal"===c.name.split(".").slice(0,1).pop()&&(a.preventDefault(),b.go("main.search.map",void 0,{location:!1}).then(function(){b.go(c,f)})):(console.warn("user not logged in!"),a.preventDefault(),d.memo("authentication"),b.go("main.authentication")):d.memo("authentication")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers",[]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("analysisController",["$timeout","$scope","$state","leafletData",function(a,b,c,d){"use strict";var e;e=this,console.log("analysisController instance created"),e.mode="map",b.$on("$stateChangeSuccess",function(f){c.includes("main.analysis")&&!c.is("main.analysis")&&(e.mode=c.current.name.split(".").slice(1,3).pop(),console.log("analysisController::mode: "+e.mode),"map"===e.mode&&d.getMap("analysis-map").then(function(c){a(function(){c&&c._container.parentElement&&(c._container.parentElement.offsetHeight>0&&c._container.parentElement.offsetWidth>0?(b.mapHeight=c._container.parentElement.offsetHeight,b.mapWidth=c._container.parentElement.offsetWidth,console.log("analysisController::stateChangeSuccess new size: "+c._container.parentElement.offsetWidth+"x"+c._container.parentElement.offsetHeight),c.invalidateSize(!1)):(console.warn("analysisController::stateChangeSuccess saved size: "+b.mapWidth+"x"+b.mapHeight),c.invalidateSize(!1)))},100)}))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("authenticationController",["$scope","$state","$previousState","authenticationService",function(a,b,c,d){"use strict";this.signIn=function(){d.authenticate({name:"Test User",roles:["User"]}),c.get("authentication")&&c.get("authentication").state&&"main.authentication"!==c.get("authentication").state.name?c.go("authentication"):b.go("main.search.map")}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("entityController",["$scope","$state","$stateParams","$previousState","$uibModalInstance","entity","entityModalInvoker",function(a,b,c,d,e,f,g){"use strict";a["class"]=c["class"],a.id=c.id,a.entity=f,console.log("entityController created"),e.result["finally"](function(){console.log(d.get("entityModalInvoker").state),d.get("entityModalInvoker")&&d.get("entityModalInvoker").state?(console.log("entityController::close goto $previousState "+d.get("entityModalInvoker").state.name),d.go("entityModalInvoker")):(console.log("entityController::close goto default main.search.map"),b.go("main.search.map"))}),a.close=function(){console.log("entityController::close"),e.dismiss("close")},a.$on("$stateChangeStart",function(a,b){b.$$state().includes["modal.entity"]?console.log("entityController::$stateChangeStart: ignore "+b):(console.log("entityController::$stateChangeStart: $uibModalInstance.close"),e.dismiss("close"))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("listController",["$scope","NgTableParams",function(a,b){"use strict";var c=this,d=[{name:"Moroni",age:50}];c.tableParams=new b({},{dataset:d}),console.log("new listController instance created from "+a.name)}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mainController",["$scope","$state","$previousState",function(a,b,c){"use strict";var d;d=this,console.log("mainController::main instance created"),d.mode=b.current.name.split(".").slice(1,2).pop(),a.$on("$stateChangeSuccess",function(a){if(b.includes("main")&&!b.is("main")){d.mode=b.current.name.split(".").slice(1,2).pop(),console.log("mainController::mainController.mode: "+d.mode);var e=c.get();e&&e.state&&e.state.name?d.previousStateName=e.state.name:d.previousStateName=void 0}else console.log("mainController::ingoring stateChange '"+b.name+"'")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mapController",["$scope","$state","$stateParams","leafletData","configurationService",function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l,m,n,o,p,q;f=this,g=e.map,k=angular.copy(g.defaults),l=angular.copy(g.maxBounds),q=angular.copy(g.maxBounds),m=angular.copy(g.basemaps),n=angular.copy(g.overlays),o=angular.copy(g.layerControlOptions),p=angular.copy(g.drawOptions),angular.extend(a,{layers:{},defaults:k,center:l,maxBounds:q,controls:{scale:!0},tileLayer:""}),h=L.Control.styledLayerControl(m,n,o),i=new L.FeatureGroup,j=new L.Control.Draw({draw:p,edit:{featureGroup:i}}),d.getMap(a.mainController.mode+"-map").then(function(b){b.addLayer(i),b.addControl(j),b.addControl(h),b.setMaxBounds(q),b.setZoom(l.zoom),b.on("draw:created",function(a){}),b.on("draw:deleted",function(b){b.layers.eachLayer(function(b){b===a.searchGeomLayer})})}),console.log(a.mainController.mode+" map controller instance created"),a.$watch(function(){return f.zoom},function(a,b){f.zoom&&a!==b})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("masterController",["$scope","$state","$previousState","configurationService","authenticationService","leafletData","geoTools",function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s;h=this,h.config=d,l=g.wicket,m=g.defaultStyle,n=g.defaultDrawOptions,o=g.noDrawOptions,q=g.readSpatialCoverage,p=g.writeSpatialCoverage,i=g.fireResize,k=new L.FeatureGroup,j=new L.Control.Draw({draw:n,edit:{featureGroup:k}}),r=!0,h.signOut=function(){e.authenticate(null),b.go("main.authentication"),c.memo("authentication")},f.getMap("mainmap").then(function(a){a.addLayer(k),a.addControl(j),a.on("draw:created",function(a){k.clearLayers(),k.addLayer(a.layer)}),a.on("draw:edited",function(){}),a.on("draw:deleted",function(a){console.log(a.layers.getLayers().length+" deleted"),k.clearLayers()})});var t="https://api.mapbox.com/styles/v1/mapbox/streets-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY3dtIiwiYSI6InFoYkpvS00ifQ.WHqQ_q865NKjIQB6Wpoi2w",u='© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',v={attribution:u},w=L.tileLayer(t,v),x=L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});f.getMap("mainmap").then(function(b){a.map=b});var y={DRAW:k},z=L.control.layers({"ESRI StreetMap":x,OpenTopoMap:w},y);f.getMap("mainmap").then(function(a){z.addTo(a)}),f.getMap("mainmap").then(function(a){a.setView([42.09618442380296,-71.5045166015625],8);L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(a);s=new L.Shapefile("bower_components/leaflet-shapefile/congress.zip",{onEachFeature:function(a,b){a.properties&&b.bindPopup(Object.keys(a.properties).map(function(b){return b+": "+a.properties[b]}).join("<br />uiui"),{maxHeight:200})}}),s.addTo(a),s.once("data:loaded",function(){})})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("searchController",["$window","$timeout","$scope","$state","leafletData",function(a,b,c,d,e){"use strict";var f;f=this,console.log("searchController instance created"),f.mode="map",c.$on("$stateChangeSuccess",function(a){d.includes("main.search")&&!d.is("main.search")&&(f.mode=d.current.name.split(".").slice(1,3).pop(),"map"===f.mode&&e.getMap("search-map").then(function(a){b(function(){a&&a._container.parentElement&&(a._container.parentElement.offsetHeight>0&&a._container.parentElement.offsetWidth?(c.mapHeight=a._container.parentElement.offsetHeight,c.mapWidth=a._container.parentElement.offsetWidth,a.invalidateSize(!1)):a.invalidateSize(!1))},100)}))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.directives",[]),angular.module("de.cismet.uim2020-html5-demonstrator.directives").directive("ngSize",["$rootScope",function(a){"use strict";return{restrict:"A",controller:["$scope",function(a){a.size={}}],link:function(b,c){var d,e;a.ngSizeDimensions=angular.isArray(a.ngSizeDimensions)?a.ngSizeDimensions:[],a.ngSizeWatch=angular.isArray(a.ngSizeWatch)?a.ngSizeWatch:[],d=function(){angular.forEach(a.ngSizeWatch,function(b,c){(a.ngSizeDimensions[c][0]!==b.offsetWidth||a.ngSizeDimensions[c][1]!==b.offsetHeight)&&(a.ngSizeDimensions[c]=[b.offsetWidth,b.offsetHeight],a.$broadcast("size::changed",c))})},e=!1,angular.forEach(a.ngSizeWatch,function(a,b){a===c[0]&&(e=b)}),e===!1&&(a.ngSizeWatch.push(c[0]),a.ngSizeDimensions.push([c[0].offsetWidth,c[0].offsetHeight]),e=a.ngSizeWatch.length-1),b.$on("size::changed",function(c,d){d===e&&(b.size||(b.size={}),b.size.width=a.ngSizeDimensions[d][0],b.size.height=a.ngSizeDimensions[d][1],console.log("width: "+b.size.width),console.log("height: "+b.size.height))}),window.ngSizeHandler||(window.ngSizeHandler=setInterval(d,10)),angular.element(window).on("resize",d)}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.filters",[]),angular.module("de.cismet.uim2020-html5-demonstrator.services",["ngResource"]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("authenticationService",["$q","$http","$timeout",function(a,b,c){"use strict";var d,e=!1;return{isIdentityResolved:function(){return angular.isDefined(d)},isAuthenticated:function(){return e},isInRole:function(a){return e&&d.roles?-1!==d.roles.indexOf(a):!1},isInAnyRole:function(a){if(!e||!d.roles)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},authenticate:function(a){d=a,e=null!==a,a?localStorage.setItem("de.cismet.uim2020-html5-demonstrator.identity",angular.toJson(a)):localStorage.removeItem("de.cismet.uim2020-html5-demonstrator.identity")},getIdentity:function(a){if(a===!0)return d=void 0,e=!1,d;var b=localStorage.getItem("de.cismet.uim2020-html5-demonstrator.identity");return b&&(d=angular.fromJson(b),e=!0),d}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("autorisationService",["$rootScope","$state","$previousState","authenticationService",function(a,b,c,d){"use strict";return{authorize:function(){return d.identity().then(function(){var e=d.isAuthenticated();a.toState.data.roles&&a.toState.data.roles.length>0&&!d.isInAnyRole(a.toState.data.roles)&&(e?(console.warn("user is not in any role"),c.memo("autorisation")):(c.memo("autorisation"),b.go("signin")))})}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("configurationService",[function(){"use strict";var a={};return a.cidsRestApi={},a.cidsRestApi.host="http://localhost:8890",a.searchService={},a.searchService.username="admin@SWITCHON",a.searchService.password="cismet",a.searchService.defautLimit=10,a.searchService.maxLimit=50,a.searchService.host=a.cidsRestApi.host,a.map={},a.map.home={},a.map.home.lat=47.61,a.map.home.lng=13.782778,a.map.home.zoom=7,a.map.maxBounds=new L.latLngBounds(L.latLng(46.372299,9.53079),L.latLng(49.02071,17.160749)),a.map.defaults={minZoom:7,maxBounds:a.map.maxBounds,path:{weight:10,color:"#800000",opacity:1},controls:{layers:{visible:!1,position:"bottomright",collapsed:!0}}},a.map.layerControlOptions={container_width:"300px",container_maxHeight:"350px",group_maxHeight:"300px",exclusive:!0},a.map.defaultLayer="Verwaltungsgrundkarte",a.map.basemaps=[{groupName:"Grundkarten",expanded:!0,layers:{Verwaltungsgrundkarte:new L.tileLayer("http://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",{subdomains:["maps","maps1","maps2","maps3","maps4"],attribution:'&copy; <a href="http://basemap.at">Basemap.at</a>, <a href="http://www.isticktoit.net">isticktoit.net</a>'}),"ArcGIS Topographic":L.esri.basemapLayer("Topographic"),OpenStreetMap:new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{id:"mainmap",attribution:'Map data © <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a> contributors'})}}],a.map.overlays=[],a.map.drawOptions={polyline:!1,polygon:{shapeOptions:{color:"#800000"},showArea:!0,metric:!0},rectangle:{shapeOptions:{color:"#800000",clickable:!1},metric:!0},circle:!1,marker:!1},a.gui={},a.gui.dev=!1,a.objectInfo={},a.objectInfo.resourceJsonUrl="http://"+a.searchService.username+":"+a.searchService.password+"@"+a.searchService.host.replace(/.*?:\/\//g,""),a.objectInfo.resourceXmlUrl="http://tl-243.xtr.deltares.nl/csw?request=GetRecordById&service=CSW&version=2.0.2&namespace=xmlns%28csw=http://www.opengis.net/cat/csw/2.0.2%29&resultType=results&outputSchema=http://www.isotc211.org/2005/gmd&outputFormat=application/xml&ElementSetName=full&id=",a.byod={},a.byod.baseUrl="http://switchon.cismet.de/sip-snapshot",a.uploadtool={},a.uploadtool.baseUrl="http://dl-ng003.xtr.deltares.nl",a}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("geoTools",["leafletData",function(a){"use strict";var b,c,d,e,f,g,h;return b=new Wkt.Wkt,c={color:"#0000FF",fillOpacity:.3,weight:2,fill:!0,fillColor:"#1589FF",riseOnHover:!0,clickable:!0},e={polyline:!1,polygon:{shapeOptions:c,showArea:!0,metric:!0,allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!</strong>"}},rectangle:{shapeOptions:c,metric:!0},circle:!1,marker:!1},d={polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:!1},f=function(a){if(a.spatialcoverage&&a.spatialcoverage.geo_field){var d=a.spatialcoverage.geo_field;-1!==d.indexOf(";")?b.read(d.substr(d.indexOf(";")+1)):b.read(d);var e=b.toObject(c);return e.setStyle(c),e}return void 0},g=function(a,b){if(b&&a.spatialcoverage){var c="SRID=4326;"+b;a.spatialcoverage.geo_field=c}},h=function(b){a.getMap(b).then(function(a){setTimeout(function(){a.invalidateSize()},50)})},{wicket:b,defaultStyle:c,defaultDrawOptions:e,noDrawOptions:d,readSpatialCoverage:f,writeSpatialCoverage:g,fireResize:h}}]);
//# sourceMappingURL=uim2020-html5-demonstrator.min.js.map