var app=angular.module("de.cismet.uim2020-html5-demonstrator",["de.cismet.uim2020-html5-demonstrator.controllers","de.cismet.uim2020-html5-demonstrator.directives","de.cismet.uim2020-html5-demonstrator.services","de.cismet.uim2020-html5-demonstrator.types","de.cismet.uim2020-html5-demonstrator.filters","ngResource","ngAnimate","ngSanitize","ngCookies","ui.bootstrap","ui.bootstrap.modal","angular.filter","ui.router","ui.router.modal","ct.ui.router.extras.sticky","ct.ui.router.extras.dsr","ct.ui.router.extras.previous","leaflet-directive","ngTable","angularjs-dropdown-multiselect","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.popover","mgcrea.ngStrap.modal","mgo-angular-wizard","ngFileUpload"]);app.config(["$logProvider","$stateProvider","$urlRouterProvider",function(a,b,c){"use strict";a.debugEnabled(!1);var d;d=function(a,b,c,d,e){var f,g,h,i,j;return g=a.defer(),h=b["class"],i=b.id,f=d.entityResource.get({className:h,objectId:i}).$promise.then(function(a){if(e.status.message='Object "'+a.name+"' aus dem UIM2020-DI Indexdatenbestand geladen.",e.status.type="success",a.$className=h,c.featureRenderer.icons[h]&&(a.$icon=c.featureRenderer.icons[h].options.iconUrl),c.featureRenderer.layergroupNames[h]?a.$classTitle=c.featureRenderer.layergroupNames[h]:a.$classTitle=h,a.src_content)try{j=angular.fromJson(a.src_content),a.$data=j,delete a.src_content}catch(b){var d='Das Objekt "'+i+"@"+h+'" konnte nicht geladen werden: '+b.message;e.status.message=d,e.status.type="warning",e.resolvedEntity=null,g.reject(d)}e.resolvedEntity=a,g.resolve(a)},function(){var a='Das Objekt "'+i+"@"+h+'" konnte nicht im UIM2020-DI Indexdatenbestand gefunden werden!';e.status.message=a,e.status.type="warning",e.resolvedEntity=null,g.reject(a)}),g.promise},c.otherwise("/search/map"),b.state("main",{"abstract":!0,sticky:!0,url:"",views:{main:{templateUrl:"views/main.html",controller:"mainController",controllerAs:"mainController"}},deepStateRedirect:{"default":{state:"main.search"}}}),b.state("main.authentication",{url:"/login",data:{roles:["User"]},views:{"authentication@main":{templateUrl:"views/authentication/login.html",controller:"authenticationController",controllerAs:"authenticationController"}}}),b.state("main.search",{url:"/search",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.search.map",params:{zoom:"15"}}},views:{"search@main":{templateUrl:"views/search/index.html",controller:"searchController",controllerAs:"searchController"},"search-toolbar@main.search":{templateUrl:"views/search/toolbar.html",controller:["$scope",function(a){a.name="main.search.toolbar",this.name="this.main.search.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.search.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},sticky:!0,views:{"search-map@main.search":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}}}),b.state("main.search.list",{url:"/list",data:{roles:["User"]},sticky:!0,views:{"search-list@main.search":{templateUrl:"views/search/list.html",controller:"listController",controllerAs:"listController"}}}),b.state("main.analysis",{url:"/analysis",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.analysis.map",params:{zoom:"14"}}},views:{"analysis@main":{templateUrl:"views/analysis/index.html",controller:"analysisController",controllerAs:"analysisController"},"analysis-toolbar@main.analysis":{templateUrl:"views/analysis/toolbar.html",controller:["$scope",function(a){a.name="main.analysis.toolbar",this.name="this.main.analysis.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.analysis.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},views:{"analysis-map@main.analysis":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}},onEnter:function(){},onExit:function(){}}),b.state("main.protocol",{url:"/protocol",data:{roles:["User"]},sticky:!0,deepStateRedirect:!0,templateUrl:"views/protocol/index.html",controller:["$scope",function(a){console.log("main.protocol created"),a.name="main.protocol",this.name="this.main.protocol"}],controllerAs:"protocolController",views:{"protocol@main":{templateUrl:"views/protocol/index.html"}}}),b.state("modal",{"abstract":!0}),b.state("modal.entity",{url:"/entity/{class:string}/{id:int}",data:{roles:["User"]},sticky:!1,backdrop:"static",templateUrl:"views/entity/modal.html",controller:"entityController",controllerAs:"entityController",size:"lg",modal:!0,resolve:{entity:["$q","$stateParams","configurationService","entityService","sharedDatamodel",d],entityModalInvoker:["$previousState",function(a){if(a.get()&&a.get().state){var b=a.get().state;if(0!==b.name.indexOf("modal"))return a.memo("entityModalInvoker"),a.get("entityModalInvoker")}}]}}),b.state("modal.export",{url:"/export",data:{roles:["User"]},sticky:!1,templateUrl:"views/export/modal.html",controller:"exportController",controllerAs:"exportController",modal:!0})}]),app.run(["$rootScope","$anchorScroll","$state","$stateParams","$previousState","configurationService","authenticationService",function(a,b,c,d,e,f,g){"use strict";a.$state=c,a.$stateParams=d,b.yOffset=50,g.resolveIdentity(!1).then(function(){console.log("app.run:: user autenticated from session cookie:"+g.isAuthenticated())}),a.$on("$stateChangeStart",function(a,b,d,h,i){"main.authentication"!==b.name?f.developmentMode||g.isAuthenticated()?""===h.name&&"modal"===b.name.split(".").slice(0,1).pop()&&(a.preventDefault(),c.go("main.search.map",void 0,{location:!1}).then(function(){c.go(b,d)})):(console.warn("user not logged in, toState:"+b.name+", fromState:"+h.name),a.preventDefault(),e.memo("authentication"),c.go("main.authentication")):e.memo("authentication")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers",[]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("aggregationTableController",["$scope","NgTableParams",function(a,b){"use strict";var c,d;c=this,c.parseDate=function(b){return a.parseDate?Date.parse(b):b},d={sorting:{name:"asc"},count:500},c.tableData=new b(d,{dataset:a.aggregationValues,counts:[]})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("analysisController",["$timeout","$scope","$state","dataService","sharedDatamodel","sharedControllers","leafletData",function(a,b,c,d,e,f,g){"use strict";var h;h=this,console.log("analysisController instance created"),h.mode="map",h.clearAnalysisNodes=function(){e.analysisNodes.length=0,f.analysisMapController.clearNodes()},h.gotoNodes=function(){f.analysisMapController.gotoNodes()},h.hasNodes=function(){return e.analysisNodes.length>0},b.$on("$stateChangeSuccess",function(d){c.includes("main.analysis")&&!c.is("main.analysis")&&(h.mode=c.current.name.split(".").slice(1,3).pop(),"map"===h.mode&&g.getMap("analysis-map").then(function(c){a(function(){c&&c._container.parentElement&&(c._container.parentElement.offsetHeight>0&&c._container.parentElement.offsetWidth>0?(b.mapHeight=c._container.parentElement.offsetHeight,b.mapWidth=c._container.parentElement.offsetWidth,c.invalidateSize(!1)):c.invalidateSize(!1))},100)}))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("appController",["$state","$previousState","configurationService","sharedDatamodel","authenticationService",function(a,b,c,d,e){"use strict";var f;f=this,f.status=d.status,f.selectedSearchThemes=d.selectedSearchThemes,f.selectedSearchPollutants=d.selectedSearchPollutants,f.resultNodes=d.resultNodes,f.signOut=function(){e.clearIdentity(),a.go("main.authentication"),b.memo("authentication")}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("authenticationController",["$scope","$state","$previousState","configurationService","authenticationService",function(a,b,c,d,e){"use strict";var f;f=this,a.errorStatusCode=-1,a.errorStatusMessage=null,f.signIn=function(f,g){a.errorStatusCode=-1,a.errorStatusMessage=null;var h=e.authenticate(f,d.authentication.domain,g);h.then(function(a){console.log('authenticationController::authenticationSuccess: user "'+a.user+'" successfully authenticated'),c.get("authentication")&&c.get("authentication").state&&"main.authentication"!==c.get("authentication").state.name?c.go("authentication"):b.go("main.search.map")},function(b){a.errorStatusCode=b.status,a.errorStatusMessage=b.statusText,a.password=null,-1===a.errorStatusCode&&(a.errorStatusCode=503),a.errorStatusMessage&&null!==a.errorStatusMessage||(a.errorStatusMessage="Verbindung zum Anmeldserver nicht möglich"),console.error('authenticationController::authenticationError: user "'+f+'" could not be authenticated: '+a.errorStatusMessage)})},f.signOut=function(){a.errorStatusCode=-1,a.errorStatusMessage=null,a.username=null,a.password=null,e.clearIdentity(),b.go("main.authentication"),c.memo("authentication")},console.log("authenticationController instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("entityController",["$scope","$state","$stateParams","$previousState","$uibModalInstance","entity","entityModalInvoker","entityService",function(a,b,c,d,e,f,g,h){"use strict";var i;i=this,a.entity=f,i.template="templates/entity/"+f.$className+".html",console.log("entityController created"),i.close=function(){e.close("close")},e.result.then(function(a){"close"===a&&(d.get("entityModalInvoker")&&d.get("entityModalInvoker").state?(console.log("entityController::close("+a+") goto $previousState "+d.get("entityModalInvoker").state.name),d.go("entityModalInvoker"),d.forget("entityModalInvoker")):(console.log("entityController::close("+a+") goto default main.search.map"),b.go("main.search.map")))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("exportController",["$scope","$state","$stateParams","$previousState","$uibModalInstance","entity","entityModalInvoker",function(a,b,c,d,e,f,g){"use strict";var h;h=this,a.wizard={},a.wizard.uploadchoice=!1,a.wizard.enterValidators=[],a.wizard.exitValidators=[],a.wizard.currentStep="",a.wizard.canProceed=!0,a.wizard.canGoBack=!1,a.wizard.hasError=!1,a.wizard.proceedButtonText="Weiter",a.wizard.isFinishStep=function(){return"Summary"===a.wizard.currentStep},a.wizard.isFirstStep=function(){return"Dataset Description"===a.wizard.currentStep},a.$watch("wizard.currentStep",function(b){b?(a.wizard.isFinishStep()?a.wizard.proceedButtonText="Fertig":a.wizard.proceedButtonText="Weiter",a.wizard.canGoBack=!a.wizard.isFirstStep()):a.wizard.proceedButtonText="Weiter"}),h.finishedWizard=function(){e.dismiss("close")},e.result["finally"](function(){b.go("main.analysis.map")}),a.close=function(){e.dismiss("close")},a.$on("$stateChangeStart",function(a,b){b.$$state().includes["modal.export"]?console.log("exportController::$stateChangeStart: ignore "+b):(console.log("exportController::$stateChangeStart: $uibModalInstance.close"),e.dismiss("close"))})}]),angular.module("de.cismet.sip-html5-resource-registration.controllers").controller("de.cismet.sip-html5-resource-registration.controllers.odRegistrationController",["$scope","$modal","$location","AppConfig","de.cismet.sip-html5-resource-registration.services.dataset","de.cismet.sip-html5-resource-registration.services.TagGroupService","de.cismet.sip-html5-resource-registration.services.searchService",function(a,b,c,d,e,f,g){"use strict";var h,i;i=void 0,h=this,h.dataset=e,h.config=d,h.groupBy=function(a){return a.name.indexOf(",")>-1?a.name.split(",",1)[0]:a.name.split(" ",1)[0]},h.checkLink=function(b){if(b){var c,e,f;e=function(b){b&&b.$collection&&b.$collection.length>0?(i='This dataset is already registered in the SWITCH-ON Spatial Information Platform under the name </strong>"'+b.$collection[0].name+'"</strong>. Click <a href="'+d.byod.baseUrl+"/#/resource/"+b.$collection[0].id+'" title="'+b.$collection[0].name+'" target="_blank">here</a> to view the dataset meta-data.',a.message.text=i,a.message.icon="fa-warning",a.message.type="info",a.wizard.hasError="datasetContentlocation"):("datasetContentlocation"===a.wizard.hasError&&(a.wizard.hasError=null),i=void 0)},f=function(a){console.error("search error: "+a),i=void 0},c=g.search(b).$promise.then(e,f)}i=void 0},h.selectKeywords=function(){b.open({animation:!0,templateUrl:"templates/keywordSelection.html",controller:"de.cismet.sip-html5-resource-registration.controllers.keywordsController",controllerAs:"keywordsController",keyboard:"true",size:"lg",scope:a})},h.gotoUploadTool=function(){var a=h.config.uploadtool.baseUrl+"?datasetname="+h.dataset.name;c.url(a)},h.checkUploadName=function(){return e.name?!0:(a.message.text="Please enter the name / title of the dataset before uploading ",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetUploadchoiceName",!1)},a.tags["function"]=f.getTagList("function"),a.tags["content type"]=f.getTagList("content type"),a.tags["keywords - X-CUAHSI"]=f.getTagList("keywords - X-CUAHSI"),a.wizard.enterValidators["Dataset Description"]=function(b){return b.valid===!0&&(a.message.text="Please provide some general information about the new dataset such as name, description, a (download) link and keywords.",a.message.icon="fa-info-circle",a.message.type="success"),b.valid},a.wizard.exitValidators["Dataset Description"]=function(b){b.valid=!0;var c=a.tags["content type"].every(function(a){return h.dataset.representation[0]&&h.dataset.representation[0].contenttype&&a.name===h.dataset.representation[0].contenttype.name?(h.dataset.representation[0].contenttype=a,!1):!0}),d=a.tags["function"].every(function(a){return h.dataset.representation[0]&&h.dataset.representation[0]["function"]&&a.name===h.dataset.representation[0]["function"].name?(h.dataset.representation[0]["function"]=a,!1):!0});return e.name?void 0===e.$uploaded?(a.message.text="Please chose wheter you want to upload a new dataset or to provide a link to anexisting dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetUploadchoice",b.valid=!1):d?(a.message.text="Please select a valid function (e.g. download) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0]["function"]?a.odRegistrationForm.datasetContentlocation.$error.url?(a.message.text="The link to the dataset you have provided is not a valid <a href='https://en.wikipedia.org/wiki/Uniform_Resource_Locator#Syntax' target='_blank' title='Uniform Resource Locator'>URL</a> .",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0].contentlocation?i?(a.message.text=i,a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):c?(a.message.text="Please select a valid content type (e.g. ESRI Shapefile) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0].contenttype?e.description?h.dataset.tags&&0!==h.dataset.tags.length||(a.message.text="Please assign at least one keyword to the Dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetTags",b.valid=!1):(a.message.text="Please provide a description of the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetDescription",b.valid=!1):(a.message.text="Please select a valid content type (e.g. ESRI Shapefile) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please provide link to the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please select a function (e.g. download) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please enter the name / title of the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetName",b.valid=!1),b.valid===!0&&(a.wizard.hasError=null),b.valid}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("externalDatasourcesController",["$scope","$uibModal","dataService","sharedDatamodel","sharedControllers",function(a,b,c,d,e){"use strict";var f,g;f=this,g=e.analysisMapController,d.globalDatasources&&0!==d.globalDatasources.length||(c.getGlobalDatasources().$resolved?f.globalDatasources=c.getGlobalDatasources():c.getGlobalDatasources().$promise.then(function(a){f.globalDatasources=a,f.globalDatasources.$resolved=!0})),f.localDatasources=d.localDatasources,f.toggleGlobalDatasourceSelection=function(a){a.$layer||(a.$layer={$selected:!0}),a.$layer.$selected===!0?a.$layer.$selected=!1:a.$layer.$selected=!0},f.addLocalDatasource=function(){b.open({animation:!1,templateUrl:"templates/external-datasource-modal.html",controller:"importController",controllerAs:"importController",resolve:{localDatasource:function(){return{}}}});a.$hide()},f.removeLocalDatasource=function(a){var b=f.localDatasources.indexOf(a);b>-1?(a.$layer.$selected===!0&&f.toggleLocalDatasourceSelection(a),f.localDatasources.splice(b,1)):console.warn("externalDatasourcesController::removeLocalDatasource: unkwon datasource?!")},f.toggleLocalDatasourceSelection=function(a){a.$layer.$selected===!0?(a.$layer.$selected=!1,g.removeOverlay(a.$layer)):(a.$layer.$selected=!0,g.addOverlay(a.$layer))}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("importController",["$scope","$uibModalInstance","dataService","featureRendererService","sharedDatamodel","sharedControllers","localDatasource",function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;h=this,i=f.analysisMapController,h.importFile=null,h.maxFilesize="10MB",h.importProgress=0,h.importInProgress=!1,h.importCompleted=!1,h.importError=!1,j=function(a){var b=new FileReader;g.name=a.name.split(".").slice(0,1).pop(),g.fileName=a.name,b.onloadstart=function(){h.importInProgress=!0,console.log("onloadstart -> importController.importInProgress:"+h.importInProgress),2!==b.readyState||b.error},b.onprogress=function(a){h.importInProgress=!0;var b,c;a.lengthComputable?(b=event.total,c=event.loaded,h.importProgress=Math.min(100,parseInt(100*c/b))):h.importProgress=100},b.onloadend=function(b){var c,d;c=b.target.result,d=b.target.error,d?(console.error("File could not be read! Code "+d.code),h.importProgress=0,h.importInProgress=!1,h.importError=!0):(h.importProgress=100,console.log("onloadend -> importController.onloadend: "+h.importProgress),k(c,a.name))},b.readAsArrayBuffer(a)},k=function(a){var b;shp(a).then(function(a){console.log("importController::convertToLayer: processing "+a.features.length+"' GeoJson Features"),b=d.createOverlayLayer(g,a,function(a,b){b===a?h.importProgress=100+Math.min(100,parseInt(100*b/a)):h.importProgress=200,200===h.importProgress&&(h.importInProgress=!1,h.importCompleted=!0)}),e.localDatasources.push(g),i.addOverlay(b)})},h["import"]=function(){null!==h.importFile?j(h.importFile):b.dismiss("cancel")},h.cancel=function(){b.dismiss("cancel")},h.close=function(){b.close(g)}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("listController",["$scope","configurationService","sharedDatamodel","sharedControllers","TagPostfilterCollection","postfilterService","NgTableParams",function(a,b,c,d,e,f,g){"use strict";var h,i,j;h=this,j=[],h.mode=a.mainController.mode,h.resultNodes=c.resultNodes,h.analysisNodes=c.analysisNodes,"search"===h.mode?h.nodes=h.resultNodes:"analysis"===h.mode&&(h.nodes=h.analysisNodes),h.tableColumns=[{field:"classKey",title:"Thema",show:!1,groupable:"classKey"},{field:"name",title:"Name",sortable:"name",show:!0},{field:"description",title:"Beschreibung",show:!0}],i={sorting:{name:"asc"},count:500},h.tableData=new g(i,{dataset:h.nodes,counts:[]}),h.pollutantPostfilters=new e("ALL","POLLUTANT","Schadstoffe"),j.push(h.pollutantPostfilters),h.notificationPeriodPostfilters=new e("EPRTR_INSTALLATION","EPRTR.NOTIFICATION_PERIOD","Meldeperiode"),j.push(h.notificationPeriodPostfilters),h.releaseTypePostfilters=new e("EPRTR_INSTALLATION","EPRTR.RELEASE_TYPE","Freisetzungsart"),j.push(h.releaseTypePostfilters),h.clearPostfilters=function(){j.forEach(function(a){a.clear()})},h.applyPostfilters=function(){var a,b;a=c.resultNodes,0===a.length&&console.warn("listController::applyPostfilters: cannot apply postfilters: no result nodes available?!"),b=f.filterNodesByTags(c.resultNodes,j),b.then(function(b){if(h.setNodes(a,!1),d.searchMapController.setNodes(a),c.filteredResultNodes.length=0,b.length>0)c.filteredResultNodes.push.apply(c.filteredResultNodes,b),b.length<a.length?(c.status.type="success",c.status.message=h.getAppliedPostfiltersSize()+" Postfilter angewendet und "+b.length+" von "+a.length+" Messstellen herausgefiltert."):(c.status.type="warning",c.status.message="Alle "+a.length+" Messstellen wurden herausgefiltert. Bitte setzen Sie die Postfilter zurück.");else{var e=h.getAppliedPostfiltersSize();e>0&&console.warn("listController::applyPostfilters: "+e+" post filters applied but no nodes filtered!"),c.status.type="success",c.status.message="Alle Postfilter zurückgesetzt."}},function(a){c.status.type="danger",c.status.message="Beim Anwenden der Postfilter ist ein Fehler aufgetreten."})},h.resetPostfilters=function(){var a=c.resultNodes;c.filteredResultNodes.length=0,f.resetFilteredNodes(a),h.setNodes(a),d.searchMapController.setNodes(a),c.status.type="success",c.status.message="Alle Postfilter zurückgesetzt."},h.getAppliedPostfiltersSize=function(){var a=0;return j.forEach(function(b){a+=b.getDeselectedKeys().length}),a},h.setNodes=function(a,b){h.tableData.reload(),b="undefined"!=typeof b?b:!0,b===!0&&h.clearPostfilters(),j.forEach(function(b){b.addAllFromNodes(a,!1,!0)})},a.$parent.listController=h,a.$on("searchSuccess()",function(a){c.resultNodes.length>0?h.setNodes(c.resultNodes):h.clearPostfilters()}),c.resultNodes&&c.resultNodes.length>0&&(console.log(c.resultNodes.length+" result nodes available before listController instance created!"),h.setNodes(c.resultNodes)),console.log("new listController instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mainController",["$scope","$state","$previousState","sharedDatamodel","sharedControllers",function(a,b,c,d,e){"use strict";var f;f=this,console.log("mainController::main instance created"),f.mode=b.current.name.split(".").slice(1,2).pop(),f.removeAnalysisNode=function(a){var b=d.analysisNodes.indexOf(a);-1!==b?(d.analysisNodes.splice(d.analysisNodes.indexOf(a),1),e.analysisMapController&&e.analysisMapController.removeNode(a)):console.warn("mainController::removeAnalysisNode: node '"+a.name+"' no in list of analysis nodes!")},f.addAnalysisNode=function(a){var b,c;for(a.$filtered&&(console.warn('mainController::addAnalysisNode: node "'+a.name+'" ('+a.objectKey+") is NOT visible (filtered)!?!"),a.$filtered=!1),c=-1,b=0;b<d.analysisNodes.length;b++)if(d.analysisNodes[b].objectKey===a.objectKey){c=b;break}if(-1!==c)console.warn("mainController::addAnalysisNode: node '"+a.name+"' already in list of analysis nodes!");else{var f=angular.extend({},a);f.$feature=null,d.analysisNodes.push(f),e.analysisMapController&&e.analysisMapController.addNode(f)}},a.$on("$stateChangeSuccess",function(a){if(b.includes("main")&&!b.is("main")){f.mode=b.current.name.split(".").slice(1,2).pop();var d=c.get();d&&d.state&&d.state.name?f.previousStateName=d.state.name:f.previousStateName=void 0}})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mapController",["$scope","$timeout","leafletData","configurationService","sharedDatamodel","sharedControllers","featureRendererService",function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;j=this,j.mode=a.mainController.mode,i=j.mode+"-map",k=d.map,m=new L.FeatureGroup,m.$name="Suchgeometrien",m.$key="searchGeometries",w=null,C=[],r=[],o=angular.copy(k.defaults),p=angular.copy(k.maxBounds),u=angular.copy(k.maxBounds),q=angular.copy(k.basemaps),s=angular.copy(k.layerControlOptions),t=angular.copy(k.drawOptions),z=angular.copy(k.fitBoundsOptions),A=null,D=angular.copy(k.nodeOverlays),"search"===j.mode?(j.nodes=e.resultNodes,f.searchMapController=j,r.push({groupName:d.map.layerGroupMappings.gazetteer,expanded:!1,layers:{}}),r.push(D),y=1,n=new L.Control.Draw({draw:t,edit:{featureGroup:m,remove:!1,buffer:{replace_polylines:!1,separate_buffer:!1,buffer_style:t.polygon.shapeOptions}}})):"analysis"===j.mode&&(j.nodes=e.analysisNodes,f.analysisMapController=j,r.push(D),r.push({groupName:d.map.layerGroupMappings.external,expanded:!1,layers:{}}),y=0),r[y].layers[k.layerMappings.BORIS_SITE].$maxZoom&&C.push(r[y].layers[k.layerMappings.BORIS_SITE]),r[y].layers[k.layerMappings.EPRTR_INSTALLATION].$maxZoom&&C.push(r[y].layers[k.layerMappings.EPRTR_INSTALLATION]),r[y].layers[k.layerMappings.MOSS].$maxZoom&&C.push(r[y].layers[k.layerMappings.MOSS]),r[y].layers[k.layerMappings.WAGW_STATION].$maxZoom&&C.push(r[y].layers[k.layerMappings.WAGW_STATION]),r[y].layers[k.layerMappings.WAOW_STATION].$maxZoom&&C.push(r[y].layers[k.layerMappings.WAOW_STATION]),x={},x.basemap_at=L.stamp(q[0].layers[k.layerMappings.basemap_at]),x.arcgisonline_com=L.stamp(q[0].layers[k.layerMappings.arcgisonline_com]),x.opentopomap_org=L.stamp(q[0].layers[k.layerMappings.opentopomap_org]),x.openstreetmap_org=L.stamp(q[0].layers[k.layerMappings.openstreetmap_org]),x.BORIS_SITE=L.stamp(r[y].layers[k.layerMappings.BORIS_SITE]),x.EPRTR_INSTALLATION=L.stamp(r[y].layers[k.layerMappings.EPRTR_INSTALLATION]),x.MOSS=L.stamp(r[y].layers[k.layerMappings.MOSS]),x.WAGW_STATION=L.stamp(r[y].layers[k.layerMappings.WAGW_STATION]),x.WAOW_STATION=L.stamp(r[y].layers[k.layerMappings.WAOW_STATION]),angular.merge(a,{layers:{},defaults:o,center:p,maxBounds:u,controls:{scale:!0}}),l=L.Control.styledLayerControl(q,r,s),B=function(a){var b;return A!==a&&null!==A&&A.$feature&&(b=g.getIconForNode(A),A.$feature.setIcon(b)),a.$feature?(A=a,b=g.getHighlightIconForNode(A),A.$feature.setIcon(b),a.$feature.$hidden&&A.$feature.setOpacity(0)):A=null,A},E=function(){if(null!==w){var a=w;w.closePopup(),w.unbindPopup(),l.removeLayer(w),h.removeLayer(w),w=null,a.setStyle(t.polygon.shapeOptions),v(a,"polygon")}else console.warn("setSearchGeometryFromGazetteerLocationLayer: no gazetteerLocationLayer available!")},v=function(a,b){console.log("setSearchGeometry: "+b),"search"===j.mode?(m.clearLayers(),null!==a&&(a.$name=b,a.$key="searchGeometry",m.addLayer(a),k.options.centerOnSearchGeometry&&m.getBounds()&&c.getMap(i).then(function(a){a.fitBounds(m.getBounds(),{animate:!0,pan:{animate:!0,duration:.6},zoom:{animate:!0},maxZoom:k.options.preserveZoomOnCenter?a.getZoom():null})}),e.selectedSearchLocation.id=1)):console.warn("mapController:: cannot add search geometry to analysis map!")},j.getSearchWktString=function(){var a,b;return a=1===m.getLayers().length?m.getLayers()[0]:new L.rectangle(h.getBounds()),b=(new Wkt.Wkt).fromObject(a),b.write()},j.unSelectOverlayByKey=function(a){a&&x[a]&&l._Layers[x[a]]?j.unSelectOverlayByKey(l._Layers[x[a]]):console.warn("mapController::unSelectOverlayByKey: unknown key '"+a+"'")},j.unSelectOverlay=function(a){l.unSelectLayer(a)},j.selectOverlayByKey=function(a){a&&x[a]&&l._Layers[x[a]]?j.selectOverlay(l._Layers[x[a]]):console.warn("mapController::selectOverlayByKey: unknown key '"+a+"'")},j.selectOverlay=function(a){l.selectLayer(a),h.fitBounds(a.getBounds(),{animate:!0,pan:{animate:!0,duration:.6},zoom:{animate:!0},maxZoom:null})},j.removeOverlayByKey=function(a){a&&x[a]&&l._Layers[x[a]]?j.removeOverlay(l._Layers[x[a]]):console.warn("mapController::removeOverlayByKey: unknown key '"+a+"'")},j.removeOverlay=function(a){j.unSelectOverlay(a),l.removeLayer(a)},j.addOverlay=function(a){if("analysis"===j.mode)if(a.$key&&a.$name){x[a.$key]=L.stamp(a);var b=a.$groupName?a.$groupName:k.layerGroupMappings.external;l.addOverlay(a,a.$name,{groupName:b}),j.selectOverlay(a)}else console.warn("mapController:: cannot add overlay layer without $name and $key property!");else console.warn("mapController:: cannot add overlay to search map!")},j.isNodeSelected=function(a){return a===A},j.gotoNode=function(a){var b,c;c=14,b=B(a),b&&(b.$feature.__parent&&b.$feature.__parent._group&&b.$feature.__parent._group.$maxZoom&&(c=b.$feature.__parent._group.$maxZoom),h.setView(A.$feature.getLatLng(),c))},j.addNode=function(a){"analysis"===j.mode?j.setNodes([a]):console.warn("mapController:: cannot add Node on search map!")},j.removeNode=function(a){var b,c,d;"analysis"===j.mode?a&&a.$feature&&a.$feature.$groupKey?(b=a.$feature,d=x[b.$groupKey],d&&l._layers[d]&&l._layers[d].layer?(c=l._layers[d].layer,c.removeLayer(b),a.$feature=null):console.warn("mapController::removeNode unsupported theme (feature group) '"+b.$groupKey+"'")):console.warn("mapController:: cannot remove Node '"+a.name+"': $feature is missing!"):console.warn("mapController:: cannot remove  Node on search map!")},j.clearNodes=function(){var a,b;a=[x.BORIS_SITE,x.EPRTR_INSTALLATION,x.MOSS,x.WAGW_STATION,x.WAOW_STATION],a.forEach(function(a){l._layers[a]&&l._layers[a].layer&&(b=l._layers[a].layer,b.clearLayers())})},j.gotoNodes=function(){var a,b,d,e;e=angular.extend({},z),b=[x.BORIS_SITE,x.EPRTR_INSTALLATION,x.MOSS,x.WAGW_STATION,x.WAOW_STATION],b.forEach(function(b){l._layers[b]&&l._layers[b].layer&&(d=l._layers[b].layer,h.hasLayer(d)&&d.getLayers()&&d.getLayers().length>0&&(a=a?a.extend(d.getBounds()):d.getBounds(),d.$maxZoom&&(e.maxZoom=d.$maxZoom)))}),a&&c.getMap(i).then(function(b){b.fitBounds(a,e)})},j.setNodes=function(a,b,c){var d,e,f,i,k;if(c!==!1&&c!==!0&&(c="search"===j.mode?!0:!1),b||(b="search"===j.mode?!0:!1),c&&j.clearNodes(),null!==a&&a.length>0){d=g.createNodeFeatureGroups(a,B);for(i in d)k=x[i],k&&l._layers[k]&&l._layers[k].layer?(e=d[i],f=l._layers[k].layer,e.forEach(function(a){if(a.addTo(f),e.$maxZoom){var b=h.getZoom();b>e.$maxZoom?(a.setOpacity(0),a.$hidden=!0):(a.setOpacity(1),a.$hidden=!1)}}),l.selectLayer(f)):console.warn("mapController::setNodes unsupported theme (feature group) '"+i+"'");b&&j.gotoNodes()}},j.setGazetteerLocation=function(a){"search"===j.mode?(console.log("mapController::setGazetteerLocation: "+a.name),null!==a?(null!==w&&(l.removeLayer(w),h.removeLayer(w),w=null),w=g.createGazetteerLocationLayer(a,E),x.gazetteer=L.stamp(w),null!==w?(l.addOverlay(w,w.$name,{groupName:k.layerGroupMappings.gazetteer}),l.selectLayer(w),h.fitBounds(w.getBounds(),z)):j.setGazetteerLocation(null)):null!==w&&(l.removeLayer(w),h.removeLayer(w),w=null)):console.warn("mapController:: cannot set gazetteerLocation on analysis map!")},j.applyZoomLevelRestriction=function(){var a;h.closePopup(),a=h.getZoom(),C.forEach(function(b){h.hasLayer(b)&&b.$maxZoom&&g.applyZoomLevelRestriction(b,a)})},"search"===j.mode&&(a.$on("gotoLocation()",function(a){"search"===j.mode&&(console.log("mapController::gotoLocation("+e.selectedGazetteerLocation.name+")"),j.setGazetteerLocation(e.selectedGazetteerLocation))}),a.$on("searchSuccess()",function(a){v(null),e.selectedSearchLocation.id=0,e.resultNodes.length>0?j.setNodes(e.resultNodes):j.clearNodes()}),a.$on("searchError()",function(a){v(null),e.selectedSearchLocation.id=0,j.clearNodes()}),a.$on("setSearchLocation()",function(a){0===e.selectedSearchLocation.id&&(v(null),e.selectedSearchLocation.id=0)})),c.getMap(i).then(function(a){h=a,a.addLayer(m),"search"===j.mode&&(a.addControl(n),a.on("draw:created",function(a){a.layerType||(a.layerType="polygon"),console.log("draw:created: "+a.layerType),v(a.layer,a.layerType),e.selectedSearchLocation.id=1,console.log("searchGeometryLayerGroup size: "+m.getLayers().length),"polyline"===a.layerType&&n._toolbars.edit._modes.buffer.handler.enable()})),a.addControl(l),a.setMaxBounds(u),a.setZoom(p.zoom),l.selectLayer(q[0].layers[k.defaultBasemapLayer]),
a.on("zoomend",function(){j.applyZoomLevelRestriction()}),a.on("layerremove",function(a){var b=a.layer;b.StyledLayerControl&&b.StyledLayerControl.removable&&l._layers[L.stamp(b)]&&l.removeLayer(b)}),a.on("layeradd",function(b){var c=b.layer;c.$maxZoom&&g.applyZoomLevelRestriction(c,a.getZoom())}),"analysis"===j.mode&&e.analysisNodes&&e.analysisNodes.length>0?(j.setNodes(e.analysisNodes,!1),b(function(){j.gotoNodes()},500)):"search"===j.mode&&e.resultNodes&&e.resultNodes.length>0&&(console.warn(e.resultNodes.length+" result nodes available before search map controler instance created: possible sticky state synchrnoisation problem!"),j.setNodes(e.resultNodes,!1,!0),b(function(){j.gotoNodes()},500))}),a.$parent.mapController=j}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("searchController",["$rootScope","$window","$timeout","$scope","$state","$uibModal","leafletData","configurationService","sharedDatamodel","sharedControllers","dataService","searchService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m,n,o,p;m=this,m.mode="map",m.status=i.status,m.searchLocations=k.getSearchLocations(),m.selectedSearchLocation=i.selectedSearchLocation,m.searchLocationsSettings=angular.extend({},h.multiselect.settings,{showCheckAll:!1,showUncheckAll:!1,styleActive:!1,closeOnSelect:!0,scrollable:!1,displayProp:"name",idProp:"id",enableSearch:!1,smartButtonMaxItems:1,selectionLimit:1,externalIdProp:"id"}),m.selectedSearchLocationEvents={onItemSelect:function(a){0===a.id&&d.$broadcast("setSearchLocation()")}},m.searchThemes=k.getSearchThemes(),m.selectedSearchThemes=i.selectedSearchThemes,m.searchThemesSettings=angular.extend({},h.multiselect.settings,{smartButtonMaxItems:0,idProp:"className",smartButtonTextConverter:function(a,b){return 1===m.selectedSearchThemes.length?"1 Thema ausgewählt":""}}),m.searchThemesTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Themen auswählen",dynamicButtonTextSuffix:"Themen ausgewählt"}),k.getSearchPollutants().$resolved?m.searchPollutants=k.getSearchPollutants():k.getSearchPollutants().$promise.then(function(a){m.searchPollutants=a}),m.selectedSearchPollutants=i.selectedSearchPollutants,m.searchPollutantsSettings=angular.extend({},h.multiselect.settings,{scrollableHeight:"600px",scrollable:!0,displayProp:"pollutant_name",idProp:"pollutant_key",searchField:"pollutant_name",enableSearch:!0,showEnableSearchButton:!1,selectByGroups:["Metalle und Schwermetalle"]}),m.searchPollutantsTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Schadstoffe auswählen",dynamicButtonTextSuffix:"Schadstoffe ausgewählt"}),k.getGazetteerLocations().$resolved?m.gazetteerLocations=k.getGazetteerLocations():k.getGazetteerLocations().$promise.then(function(a){m.gazetteerLocations=a}),m.selectedGazetteerLocation=i.selectedGazetteerLocation,m.gazetteerLocationsSettings=angular.extend({},h.multiselect.settings,{styleActive:!1,closeOnSelect:!0,scrollableHeight:"600px",scrollable:!0,displayProp:"name",idProp:"$self",searchField:"name",enableSearch:!0,smartButtonMaxItems:1,selectionLimit:1,externalIdProp:""}),m.gazetteerLocationsTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Ort auswählen"}),o=function(){var b;b=a.$new(!0),b.status=m.status,p=f.open({templateUrl:"templates/search-progress-modal.html",scope:b,size:"lg",backdrop:"static"}),p.opened.then(function(){"error"===m.status.type&&p.close()})},n=function(a,b,d){m.status.progress.max=100,-1===b&&"success"===d?(m.status.progress.current=a,95>a?(m.status.message="Die Suche im UIM2020-DI Indexdatenbestand wird durchgeführt",m.status.type="success"):(m.status.message="Die UIM2020-DI Server sind z.Z. ausgelastet, bitte warten Sie einen Augenblick.",m.status.type="warning")):a===b&&"success"===d?(a>0?(m.status.progress.current=100,m.status.message="Suche erfolgreich, "+(1===a?"eine Messstelle":a+" Messstellen")+" im UIM2020-DI Indexdatenbestand gefunden.",m.status.type="success"):(m.status.progress.current=100,m.status.message="Es wurden keine zu den Suchkriterien passenden Messstellen im UIM2020-DI Indexdatenbestand gefunden",m.status.type="warning"),p&&c(function(){p.close()},500)):"error"===d&&(m.status.progress.current=100,m.status.message="Die Suche konnte aufgrund eines Server-Fehlers nicht durchgeführt werden.",m.status.type="danger",c(function(){p&&p.close(m.status.message)},2e3))},m.gotoLocation=function(){"map"!==m.mode&&e.go("^.map"),d.$broadcast("gotoLocation()")},m.gotoNodes=function(){"map"!==m.mode&&e.go("^.map"),j.searchMapController.gotoNodes()},m.hasNodes=function(){return i.resultNodes.length>0},m.search=function(a){var b,c,e,f,g;b=j.searchMapController.getSearchWktString(),c=[],e=[],f=500,g=0,i.selectedSearchThemes.forEach(function(a){c.push(a.id)}),i.selectedSearchPollutants.forEach(function(a){e.push(a.id)}),o(),l.defaultSearch(b,c,e,f,g,n).$promise.then(function(a){i.resultNodes.length=0,a.$collection&&a.$collection.length>0&&i.resultNodes.push.apply(i.resultNodes,a.$collection),d.$broadcast("searchSuccess()")},function(a){i.resultNodes.length=0,d.$broadcast("searchError()")})},d.$on("$stateChangeSuccess",function(a){e.includes("main.search")&&!e.is("main.search")&&(m.mode=e.current.name.split(".").slice(1,3).pop(),"map"===m.mode&&g.getMap("search-map").then(function(a){c(function(){a&&a._container.parentElement&&(a._container.parentElement.offsetHeight>0&&a._container.parentElement.offsetWidth?(d.mapHeight=a._container.parentElement.offsetHeight,d.mapWidth=a._container.parentElement.offsetWidth,a.invalidateSize(!1)):a.invalidateSize(!1))},100)}))}),console.log("searchController instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.directives",[]),angular.module("de.cismet.uim2020-html5-demonstrator.directives").directive("aggregationTable",[function(){"use strict";return{restrict:"E",templateUrl:"templates/aggregation-table-directive.html",scope:{aggregationValues:"=",parseDate:"="},controller:"aggregationTableController",controllerAs:"aggregationTableController"}}]),angular.module("de.cismet.uim2020-html5-demonstrator.filters",[]),angular.module("de.cismet.uim2020-html5-demonstrator.filters").filter("descriptionFilter",function(){"use strict";return function(a){var b="keine Beschreibung verfügbar";return a?(a.literatur||a.institut?a.literatur?(b=a.literatur,a.institut&&(b+=" ("+a.institut+")")):b=a.institut:a.naceclass||a.erasid?b=a.naceclass?a.naceclass:a.erasid:a.zustaendigestelle||a.bundesland?b=a.zustaendigestelle?"Zuständige Stelle: "+a.zustaendigestelle:"Bundesland Stelle: "+a.bundesland:(a.labno||a.sampleid)&&(b=a.labNo?"Labornummer: "+a.labNo:"",a.sampleid&&(b+="Probennummer: "+a.sampleid)),b):b}}),angular.module("de.cismet.uim2020-html5-demonstrator.filters").filter("textLengthFilter",function(){"use strict";var a,b;return a=/[-\/\\^$*+?.()|[\]{}]/g,b=function(b,c){return new RegExp("["+b.replace(a,"\\$&")+"]",c)},function(a,c,d,e,f,g){var h,i,j,k,l,m,n;if(!a||void 0===c||null===c)return null;if(c>=a.length)m=a;else if(h=void 0===d||null===d?!1:d,k=void 0===e||null===e?"[...]":e,i=void 0===f||null===f?!1:f,j=void 0===g||null===g?".!?;:":g,i&&0===c)l=a.match(b(j,"")),m=l?l.index>=a.length-1?a:a.substr(0,l.index+1)+" "+k:k;else{if(m=a.substr(0,c-k.length),i){for(n=b(j,"g"),l=0;null!==n.exec(m.substr(0,m.length-1));)l=n.lastIndex;l>0&&(m=m.substr(0,l+1)+" ")}h?m+=k:(l=m.match(/\s+\w*$/),l?m=m.substr(0,l.index+1)+k:m+=k)}return m}}),angular.module("de.cismet.uim2020-html5-demonstrator.services",["ngResource"]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("authenticationService",["$q","$http","$cookieStore","configurationService","base64",function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l,m,n,o,p;return f=null,h=function(){return angular.isDefined(f)},i=function(){return void 0!==f&&null!==f&&void 0!==f.authorizationToken&&null!==f.authorizationToken},j=function(a){return i()&&f.userGroups?-1!==f.userGroups.indexOf(a):!1},k=function(a){if(!i()||!f.userGroups)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},l=function(a,b,c){var d;return d="Basic "+e.encode(a+"@"+b+":"+c),g(d)},g=function(e){var g,h,i;return f=null,h=d.cidsRestApi.host+"/users",g=a.defer(),i={method:"GET",url:h,headers:{Authorization:e,Accept:"application/json"}},b(i).then(function(a){f=a.data,f.authorizationToken=e,c.put(d.authentication.cookie,f),g.resolve(f)},function(a){g.reject(a)}),g.promise},m=function(b){return i()?a.when(f):(f=c.get(d.authentication.cookie),i()?b?g(f.authorizationToken):a.when(f):(console.warn("no stored session cookie available, user has to re-authenticate"),a.when(f)))},n=function(){return f},o=function(){return i()?f.authorizationToken:null},p=function(){f=null,c.put(d.authentication.cookie,null)},m(),{isIdentityResolved:h,isAuthenticated:i,isInRole:j,isInAnyRole:k,authenticate:l,resolveIdentity:m,getIdentity:n,getAuthorizationToken:o,clearIdentity:p}}]).factory("base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&console.error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!==g&&(h+=String.fromCharCode(d)),64!==j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("autorisationService",["$rootScope","$state","$previousState","authenticationService",function(a,b,c,d){"use strict";return{authorize:function(){return d.identity().then(function(){var e=d.isAuthenticated();a.toState.data.roles&&a.toState.data.roles.length>0&&!d.isInAnyRole(a.toState.data.roles)&&(e?(console.warn("user is not in any role"),c.memo("autorisation")):(c.memo("autorisation"),b.go("signin")))})}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("configurationService",[function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;a=this,a.developmentMode=!0,a.cidsRestApi={},a.cidsRestApi.host="http://DEMO-NOTEBOOK:8890",a.cidsRestApi.domain="UDM2020-DI",a.cidsRestApi.defaultRestApiSearch="de.cismet.cids.custom.udm2020di.serversearch.DefaultRestApiSearch",a.authentication={},a.authentication.domain=a.cidsRestApi.domain,a.authentication.username="uba",a.authentication.password="",a.authentication.role="UDM2020",a.authentication.cookie="de.cismet.uim2020-html5-demonstrator.identity",a.searchService={},a.searchService.defautLimit=10,a.searchService.maxLimit=50,a.searchService.host=a.cidsRestApi.host,a.featureRenderer={},a.featureRenderer.gazetteerStyle={color:"#8856a7",fillColor:"#feb24c",fillOpacity:.3,fill:!0,weight:4,riseOnHover:!1,clickable:!0},a.featureRenderer.defaultStyle={color:"#0000FF",fill:!1,weight:2,riseOnHover:!0,clickable:!1},a.featureRenderer.highlightStyle={fillOpacity:.4,fill:!0,fillColor:"#1589FF",riseOnHover:!0,clickable:!1},a.featureRenderer.icons={},a.featureRenderer.icons.BORIS_SITE=L.icon({iconUrl:"icons/showel_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.WAGW_STATION=L.icon({iconUrl:"icons/wagw_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.WAOW_STATION=L.icon({iconUrl:"icons/waow_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.EPRTR_INSTALLATION=L.icon({iconUrl:"icons/factory_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.MOSS=L.icon({iconUrl:"icons/grass_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.highlightIcons={},a.featureRenderer.highlightIcons.BORIS_SITE=L.icon({iconUrl:"icons/showel_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[28,28],shadowAnchor:[14,14]}),a.featureRenderer.highlightIcons.WAGW_STATION=L.icon({iconUrl:"icons/wagw_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.WAOW_STATION=L.icon({iconUrl:"icons/waow_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.EPRTR_INSTALLATION=L.icon({iconUrl:"icons/factory_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.MOSS=L.icon({iconUrl:"icons/grass_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.layergroupNames={},a.featureRenderer.layergroupNames.MOSS="Moose",a.featureRenderer.layergroupNames.EPRTR_INSTALLATION="ePRTR Einrichtungen",a.featureRenderer.layergroupNames.WAOW_STATION="Wassermesstellen",a.featureRenderer.layergroupNames.WAGW_STATION="Grundwassermesstellen",a.featureRenderer.layergroupNames.BORIS_SITE="Bodenmesstellen",a.map={},a.map.options={},a.map.options.centerOnSearchGeometry=!0,a.map.options.preserveZoomOnCenter=!1,a.map.home={},a.map.home.lat=47.61,a.map.home.lng=13.782778,a.map.home.zoom=8,a.map.maxBounds=new L.latLngBounds(L.latLng(46.372299,9.53079),L.latLng(49.02071,17.160749)),a.map.layerControlOptions={container_width:"250px",container_maxHeight:"900px",group_maxHeight:"400px",exclusive:!1},a.map.layerGroupMappings={basemaps:"Grundkarten",nodes:"Themen",gazetteer:"Aktueller Ort",external:"Externe Datenquellen"},a.map.layerMappings={basemap_at:"Verwaltungsgrundkarte",arcgisonline_com:"ArcGIS Topographic",opentopomap_org:"OpenTopoMap",openstreetmap_org:"OpenStreetMap",BORIS_SITE:"Bodenmesstellen",EPRTR_INSTALLATION:"ePRTR Einrichtungen",MOSS:"Moose",WAOW_STATION:"Wassermesstellen",WAGW_STATION:"Grundwassermesstellen"},a.map.defaultBasemapLayer="Verwaltungsgrundkarte",n=.6,b=new L.tileLayer("http://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",{subdomains:["maps","maps1","maps2","maps3","maps4"],attribution:'&copy; <a href="http://basemap.at">Basemap.at</a>, <a href="http://www.isticktoit.net">isticktoit.net</a>',opacity:n}),b.$name=a.map.layerMappings.basemap_at,b.$key="basemap_at",b.$groupName="Grundkarten",b.$groupKey="basemaps",c=L.esri.basemapLayer("Topographic",{opacity:n}),c.$name=a.map.layerMappings.arcgisonline_com,c.$key="arcgisonline_com",c.$groupName=a.map.layerGroupMappings.basemaps,c.$groupKey="basemaps",e=new L.TileLayer("http://opentopomap.org/{z}/{x}/{y}.png",{attribution:'Map data © <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a> contributors, SRTM | Rendering: © <a href="http://opentopomap.org" target="_blank">OpenTopoMap</a> (CC-BY-SA)',opacity:n}),e.$name=a.map.layerMappings.opentopomap_org,e.$key="opentopomap_org",e.$groupName=a.map.layerGroupMappings.basemaps,e.$groupKey="basemaps",d=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data © <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a> contributors',opacity:n}),d.$name=a.map.layerMappings.openstreetmap_org,d.$key="openstreetmap_org",d.$groupName=a.map.layerGroupMappings.basemaps,d.$groupKey="basemaps",k={},k[a.map.layerMappings.basemap_at]=b,k[a.map.layerMappings.arcgisonline_com]=c,k[a.map.layerMappings.opentopomap_org]=e,k[a.map.layerMappings.openstreetmap_org]=d,a.map.defaults={minZoom:a.map.home.zoom,maxBounds:a.map.maxBounds,controls:{layers:{visible:!1,position:"bottomright",collapsed:!0}},tileLayer:""},a.map.basemaps=[{groupName:a.map.layerGroupMappings.basemaps,expanded:!0,layers:k,removeOutsideVisibleBounds:!0}],o={$icon:null,$theme:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,iconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=10>b?"small":25>b?"medium":"large",new L.DivIcon({html:'<div title="'+b+" "+this.$theme+'"><span><img src="'+this.$icon+'" alt="'+this.$theme+'"" style="margin:0;padding:0;vertical-align: middle;max-height: 16px;max-width: 16px;"/></span></div>',className:"marker-cluster"+c,iconSize:new L.Point(40,40)})}},p=angular.copy(o),p.$theme=a.map.layerMappings.BORIS_SITE,p.$icon=a.featureRenderer.icons.BORIS_SITE.options.iconUrl,f=new L.markerClusterGroup(p),f.$name=a.map.layerMappings.BORIS_SITE,f.$key="BORIS_SITE",f.$groupName=a.map.layerGroupMappings.nodes,f.$groupKey="nodes",f.StyledLayerControl={removable:!1,visible:!1},q=angular.copy(o),q.$theme=a.map.layerMappings.EPRTR_INSTALLATION,q.$icon=a.featureRenderer.icons.EPRTR_INSTALLATION.options.iconUrl,g=new L.markerClusterGroup(q),g.$name=a.map.layerMappings.EPRTR_INSTALLATION,g.$key="EPRTR_INSTALLATION",g.$groupName=a.map.layerGroupMappings.nodes,g.$groupKey="nodes",g.StyledLayerControl={removable:!1,visible:!1},r=angular.copy(o),r.$theme=a.map.layerMappings.MOSS,r.$icon=a.featureRenderer.icons.MOSS.options.iconUrl,h=new L.markerClusterGroup(r),h.$name=a.map.layerMappings.MOSS,h.$key="MOSS",h.$groupName=a.map.layerGroupMappings.nodes,h.$groupKey="nodes",h.StyledLayerControl={removable:!1,visible:!1},s=angular.copy(o),s.$theme=a.map.layerMappings.WAGW_STATION,s.$icon=a.featureRenderer.icons.WAGW_STATION.options.iconUrl,s.zoomToBoundsOnClick=!0,s.maxClusterRadius=250,s.disableClusteringAtZoom=12,s.removeOutsideVisibleBounds=!1,i=new L.markerClusterGroup(s),i.$name=a.map.layerMappings.WAGW_STATION,i.$key="WAGW_STATION",i.$groupName=a.map.layerGroupMappings.nodes,i.$groupKey="nodes",i.$maxZoom=12,i.StyledLayerControl={removable:!1,visible:!1},t=angular.copy(o),t.$theme=a.map.layerMappings.WAOW_STATION,t.$icon=a.featureRenderer.icons.WAOW_STATION.options.iconUrl,j=new L.markerClusterGroup(t),j.$name=a.map.layerMappings.WAOW_STATION,j.$key="WAOW_STATION",j.$groupName=a.map.layerGroupMappings.nodes,j.$groupKey="nodes",j.StyledLayerControl={removable:!1,visible:!1},l={},l[a.map.layerMappings.BORIS_SITE]=f,l[a.map.layerMappings.EPRTR_INSTALLATION]=g,l[a.map.layerMappings.MOSS]=h,l[a.map.layerMappings.WAGW_STATION]=i,l[a.map.layerMappings.WAOW_STATION]=j,a.map.nodeOverlays={groupName:a.map.layerGroupMappings.nodes,expanded:!0,layers:l},a.map.searchOverlays=[],angular.merge([],[{groupName:a.map.layerGroupMappings.gazetteer,expanded:!1,layers:{}}],m),a.map.analysisOverlays=angular.merge([],m,[{groupName:a.map.layerGroupMappings.external,expanded:!1,layers:{}}]),a.map.drawOptions={polyline:{shapeOptions:{color:"#006d2c",clickable:!0},metric:!0,allowIntersection:!1},polygon:{shapeOptions:{color:"#006d2c",clickable:!0},showArea:!0,metric:!0,allowIntersection:!1},rectangle:{shapeOptions:{color:"#006d2c",clickable:!0},metric:!0},circle:!1,marker:!1},L.drawLocal.draw.toolbar.actions.title="Zeichnen abbrechen",L.drawLocal.draw.toolbar.actions.text="Abbrechen",L.drawLocal.draw.toolbar.finish.title="Zeichnen beenden",L.drawLocal.draw.toolbar.finish.text="Beenden",L.drawLocal.draw.toolbar.undo.title="Letzten Punkt löschen",L.drawLocal.draw.toolbar.undo.text="Letzten Punkt löschen",L.drawLocal.draw.toolbar.buttons.polyline="Innerhalb eines Linienzugs suchen",L.drawLocal.draw.toolbar.buttons.polygon="Innerhalb eines Polygons suchen",L.drawLocal.draw.toolbar.buttons.rectangle="Innerhalb eines Rechtecks suchen",L.drawLocal.edit.toolbar.buttons.buffer="Ausgewählte Geometrie um Puffer erweitern",L.drawLocal.edit.toolbar.buttons.bufferDisabled="Keine Geometrie zum Erweitern vorhanden",L.drawLocal.draw.handlers.polygon.tooltip.start="Klicken um ein Polygon zu zeichnen",L.drawLocal.draw.handlers.polygon.tooltip.cont="Klicken um das Polygon zu erweitern",L.drawLocal.draw.handlers.polygon.tooltip.end="Mit Doppelklick das Polygon schließen",L.drawLocal.draw.handlers.polyline.tooltip.start="Klicken um einen Linienzug zu zeichnen",L.drawLocal.draw.handlers.polyline.tooltip.cont="Klicken um den Linienzug zu erweitern",L.drawLocal.draw.handlers.polyline.tooltip.end="Mit Doppelklick das Zeichnen des Linienzugs zu beenden",L.drawLocal.draw.handlers.polyline.error="<strong>Achtung: </strong><br/>Die Kanten des Linienzugs dürfen sich nicht überschneiden!",L.drawLocal.draw.handlers.rectangle.tooltip.start="Klicken um ein Rechteck zu zeichnen",L.drawLocal.draw.handlers.simpleshape.tooltip.end="Klicken um das Zeichnen zu beenden",L.drawLocal.edit.toolbar.actions.save.title="Änderungen speichern",L.drawLocal.edit.toolbar.actions.save.text="Speichern",L.drawLocal.edit.toolbar.actions.cancel.title="Abbrechnen und alle Änderungen verwerfen",L.drawLocal.edit.toolbar.actions.cancel.text="Abbrechnen",L.drawLocal.edit.toolbar.buttons.edit="Geometrie bearbeiten",L.drawLocal.edit.toolbar.buttons.editDisabled="Keine Geometrie zum Bearbeiten vorhanden",L.drawLocal.edit.toolbar.buttons.remove="Geometrie entfernen",L.drawLocal.edit.toolbar.buttons.removeDisabled="Keine Geometrie zum Entfernen vorhanden",L.drawLocal.edit.handlers.edit.tooltip.text="Kontrollpunkte verschieben um die Geometrie zu verändern",L.drawLocal.edit.handlers.edit.tooltip.subtext="Auf Abgrechen klicken, um Änderungen rückgängig zu machen",L.drawLocal.edit.handlers.remove.tooltip.text="Auf eine Geometrie klicken, um diese zu entfernen",L.drawLocal.edit.handlers.buffer.tooltip.text="Klicken und Ziehen um die Geometrie zu vergrößern oder zu verkleinern",a.map.fitBoundsOptions={animate:!0,pan:{animate:!0,duration:.75},zoom:{animate:!0},maxZoom:null},a.multiselect={},a.multiselect.settings={styleActive:!0,displayProp:"name",idProp:"id",buttonClasses:"btn btn-default navbar-btn cs-search-multiselect"},a.multiselect.translationTexts={checkAll:"Alles auswählen",uncheckAll:"Alles abwählen",enableSearch:"Suche aktivieren",disableSearch:"Suche deaktivieren",selectionCount:" ausgewählt",selectionOf:" von ",searchPlaceholder:"Suche...",buttonDefaultText:"Auswählen",dynamicButtonTextSuffix:"ausgewählt",selectGroup:"Alle auswählen: "}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("dataService",["$resource",function(a){"use strict";var b,c,d,e,f;return f=[{name:"Gesamter Kartenausschnitt",id:0,geometry:null},{name:"Ausgewählte Geometrie",id:1,geometry:null,disabled:!0}],b={searchThemes:"data/searchThemes.json",searchPollutants:"data/searchPollutants.json",gazetteerLocations:"data/gazetteerLocations.json",filterPollutants:"data/filterPollutants.json",mockNodes:"data/resultNodes.json",mockObjects:"data/resultObjects.json",globalDatasources:"data/globalDatasources.json"},c=[],d=function(d,e){var f;return c.hasOwnProperty(d)?(f=c[d],f.$resolved||console.warn("possible synchonisation problem for cached resource "+d),f):b.hasOwnProperty(d)?(f=a(b[d],{},{query:{method:"GET",params:{},isArray:e}}),c[d]=f.query(),c[d]):(console.warn("unknown static resource:"+d),null)},e=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a},{getSearchLocations:function(){return f},getSearchThemes:function(){return d("searchThemes",!0)},getSearchPollutants:function(){return d("searchPollutants",!0)},getGazetteerLocations:function(){return d("gazetteerLocations",!0)},getGlobalDatasources:function(){return d("globalDatasources",!0)},getMockNodes:function(){var a=d("mockNodes",!0);return a.$resolved&&e(a),a}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("entityService",["$resource","configurationService","authenticationService",function(a,b,c){"use strict";var d,e;return d=b.cidsRestApi,e=a(d.host+"/"+d.domain+".:className/:objectId",{omitNullValues:!0,deduplicate:!0,role:"default"},{get:{method:"GET",isArray:!1,headers:{Authorization:c.getAuthorizationToken()}}}),{entityResource:e}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("featureRendererService",["$location","configurationService",function(a,b){"use strict";var c,d,e,f,g,h,i,j,k;return c=b.featureRenderer,e=function(b,d,e){if(b.hasOwnProperty("cachedGeometry")){var f,g,h,i,j,k;return b.cachedGeometry?(i=c.icons[d],f=b.cachedGeometry,g=new Wkt.Wkt,g.read(f.substr(f.indexOf(";")+1)),j={icon:i,title:b.name},k=L.popup.angular({template:'<div><h5><span class="btn-icon"><img src="{{$content.node.$icon}}" alt="{{$content.node.$classTitle}}"/></span>&nbsp;<strong><a data-ui-sref="modal.entity({class: $content.node.classKey.split(\'.\').slice(1, 2).pop(), id:$content.node.LEGACY_OBJECT_ID})" ng-click="$content.node.$feature.closePopup()">{{$content.node.name}}</a></strong></h5><div><p>{{$content.node.$data | descriptionFilter}}</p></div></div>'}),k.setContent({node:b}),h=g.toObject(j),h.$name=b.name,h.$key=b.objectKey,h.$groupKey=d,h.$node=b,h.$hidden=!1,h.on("click",function(b){e(this.$node),a.hash("anchor"+this.$node.objectKey)}),h.bindPopup(k),b.$feature=h,b.$icon=i.options.iconUrl,h):(console.warn("no cached geometry for node "+b.name+" ("+b.objectKey+")"),null)}},f=function(a,b){var d,e,f,g,h;if(a.hasOwnProperty("area"))d=a.area.geo_field,f=!1;else{if(!a.hasOwnProperty("geometry"))return null;d=a.geometry.geo_field,f=!0}return e=new Wkt.Wkt,e.read(d.substr(d.indexOf(";")+1)),g=f===!0?e.toObject().getLayers()[0]:e.toObject(),g.setStyle(angular.copy(c.gazetteerStyle)),g.$name=a.name,g.$key="gazetteerLocation",h=L.popup.angular({template:'<div><h5"><strong><a ng-click="$content.setSearchGeometryFromGazetteerLocation()">Diese Geometrie für die Suche verwenden</a></strong></h5></div>'}),h.setContent({setSearchGeometryFromGazetteerLocation:b}),g.bindPopup(h),g},g=function(a,b){var c,d,f,g,h,i;for(i=[],c=0;c<a.length;++c)d=a[c],d.$filtered===!1?(f=d.classKey.split(".").slice(1,2).pop(),"undefined"!=typeof d.$feature&&d.$feature?(console.log('featureRendererService::createNodeFeatureGroups: reusing feature  for node "'+d.name+" ("+d.objectKey+")"),g=d.$feature):g=e(d,f,b),"undefined"!=typeof g&&g&&(i.hasOwnProperty(f)?h=i[f]:(h=[],i[f]=h),h.push(g))):console.log('featureRendererService::createNodeFeatureGroups: ignoring filtered node node "'+d.name+" ("+d.objectKey+")");return i},h=function(a,b,c){var d,e=0;return b.fileName=a.fileName,d=L.geoJson(b,{onEachFeature:function(a,d){a.properties&&d.bindPopup(Object.keys(a.properties).map(function(b){return b+": "+a.properties[b]}).join("<br />"),{maxHeight:200}),c&&c(b.features.length,e++)}}),d.$name=a.name,d.$key=a.fileName,d.$selected=!0,d.StyledLayerControl={removable:!0,visible:!1},a.$layer=d,d},i=function(a){var b,d;return b=a.classKey.split(".").slice(1,2).pop(),d=c.icons[b]},j=function(a){var b,d;return b=a.classKey.split(".").slice(1,2).pop(),d=c.highlightIcons[b]},k=function(a,b){var c=a.$maxZoom;b>c?a.eachLayer(function(a){a.setOpacity(0),a.$hidden=!0}):a.eachLayer(function(a){a.setOpacity(1),a.$hidden=!1})},d=function(a){var b,d,e,f;return e=null,!e&&a.spatialcoverage&&a.spatialcoverage.geo_field&&(b=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(b.substr(b.indexOf(";")+1)),f=Object.create(c.defaultStyle),a.name&&(f.title=a.name),e=d.toObject(f),e.setStyle(c.defaultStyle)),a&&a.$self&&"/switchon.resource"===a.$self.substr(0,18).toLowerCase()&&a.representation&&a.representation.every(function(c){var f,g;return c.name&&c.contentlocation&&c.type&&"aggregated data"===c.type.name&&c["function"]&&"service"===c["function"].name&&c.protocol&&("WWW:TILESERVER"===c.protocol.name?(e=L.tileLayer(c.contentlocation,{tms:"true",zIndex:999}),e.getBounds=function(){return a.spatialcoverage&&a.spatialcoverage.geo_field?(b=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(b.substr(b.indexOf(";")+1)),d.toObject().getBounds()):void 0},e.setOpacity(0)):"OGC:WMS-1.1.1-http-get-capabilities"===c.protocol.name&&(f=c.contentlocation,g=c.name,e=L.tileLayer.wms(f,{layers:g,format:"image/png",transparent:!0,version:"1.1.1",zIndex:999}),e.getBounds=function(){return a.spatialcoverage&&a.spatialcoverage.geo_field?(b=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(b.substr(b.indexOf(";")+1)),d.toObject().getBounds()):void 0},e.setOpacity(0))),null===e}),e},{createNodeFeatureGroups:g,createGazetteerLocationLayer:f,createOverlayLayer:h,getIconForNode:i,getHighlightIconForNode:j,applyZoomLevelRestriction:k,defaultStyle:c.defaultStyle,highlightStyle:c.highlightStyle}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("objectRendererService",["configurationService",function(a){"use strict";var b;return b=function(a){return a},{getObjectIcon:b}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("postfilterService",["$q","sharedDatamodel",function(a,b){"use strict";var c,d,e;return d=function(c,d){return a(function(a,e){var f=[];b.resultNodes!==c&&(console.error("postfilterService::getFilteredNodeIndices: provided nodes array ("+c.length+" does not match sharedDatamodel.resultNodes ("+b.resultNodes.length+")!"),e(f)),d.forEach(function(a){c.forEach(function(b,c){if(!f.includes(c)&&("ALL"===a.className||a.className===b.$className)){var d,e,g;d=b.$data.tags,e=a.getDeselectedKeys(),g=!d.every(function(a,b,c){return!e.includes(a.key)}),g&&f.push(c)}})}),console.log("postfilterService: filtered "+f.length+" nodes of "+c.length+" available result nodes nodes"),a(f)})},c=function(a,b){var c=d(a,b);return c.then(function(b){return a.forEach(function(a,c,d){b.includes(c)?a.$filtered=!0:a.$filtered=!1}),b},function(a){return a})},e=function(a){a.forEach(function(a,b,c){a.$filtered=!1})},{filterNodesByTags:c,resetFilteredNodes:e}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("searchService",["$resource","$q","$interval","configurationService","authenticationService",function(a,b,c,d,e){"use strict";var f,g;return f=d.cidsRestApi,g=function(g,h,i,j,k,l){var m,n,o,p,q,r,s,t;return n=angular.noop,(l||n)(0,-1,"success"),t=1,s=c(function(){(l||n)(t,-1,"success"),t++},100,100),m=b.defer(),o={list:[{key:"geometry",value:g},{key:"themes",value:h},{key:"pollutants",value:i}]},k&&j&&j>0&&k>0&&k%j!==0&&(k=0),p={$promise:m.promise,$resolved:!1,$offset:k,$limit:j,$length:0},q=a(f.host+"/searches/"+f.domain+"."+f.defaultRestApiSearch+"/results",{limit:100,offset:0,omitNullValues:!0,deduplicate:!0},{search:{method:"POST",params:{limit:"@limit",offset:"@offset"},isArray:!1,headers:{Authorization:e.getAuthorizationToken()}}}),r=q.search({limit:j,offset:k},o),r.$promise.then(function(a){var b,e,f,g,h,i;for(b in a)if(a.hasOwnProperty(b)&&("$"!==b.charAt(0)||"$"!==b.charAt(1))&&(p[b]=a[b],"$collection"===b&&angular.isArray(p.$collection)))for(f=p.$collection.length,e=0;f>e;e++)if(g=p.$collection[e],i=g.classKey.split(".").slice(1,2).pop(),g.$filtered=!1,g.$className=i,d.featureRenderer.icons[i]&&(g.$icon=d.featureRenderer.icons[i].options.iconUrl),d.featureRenderer.layergroupNames[i]?g.$classTitle=d.featureRenderer.layergroupNames[i]:g.$classTitle=i,g.lightweightJson)try{h=angular.fromJson(g.lightweightJson),g.$data=h,delete g.lightweightJson}catch(j){console.error(j.message)}p.$length=a.$collection?a.$collection.length:0,p.$total&&0!==p.$total||(p.$total=p.length),m.resolve(p),c.cancel(s),(l||n)(p.$length,p.$length,"success")},function(a){var b="cannot search for resources: "+a.statusText+"("+a.status+")";console.error(b),p.$error=b,p.$response=a,p.$resolved=!0,m.reject(p),c.cancel(s),(l||n)(1,1,"error")}),p},{defaultSearch:g}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("sharedControllers",[function(){"use strict";this.appController=void 0,this.mainController=void 0,this.analysisMapController=void 0,
this.searchController=void 0,this.analysisMapController=void 0,this.searchMapController=void 0,this.searchListController=void 0,this.protocolController=void 0}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("sharedDatamodel",[function(){"use strict";this.identity=null,this.resolvedEntity=null,this.selectedSearchThemes=[],this.selectedSearchPollutants=[],this.selectedGazetteerLocation={},this.selectedSearchLocation={id:0},this.resultNodes=[],this.analysisNodes=[],this.filteredResultNodes=[],this.selectedGlobalDatasources=[],this.localDatasources=[],this.selectedLocalDatasources=[],this.status={},this.status.type="success",this.status.message="UIM-2020 Demonstrator Datenintegration",this.status.progress={},this.status.progress.current=0,this.status.progress.max=0}]),angular.module("de.cismet.uim2020-html5-demonstrator.types").factory("TagPostfilterCollection",[function(){"use strict";function a(a,b,c){this.className=a,this.taggroupkey=b,this.title=c,this.tags=[],this.tagsKeys=[],this.forbiddenTags=["METplus","KWSplus","PESTplus","THGundLSSplus","DNMplus","SYSSplus"]}return a.prototype.clear=function(){this.tagsKeys.length=0,this.tags.length=0},a.prototype.addTag=function(a){return a&&a.key&&a.taggroupkey&&this.taggroupkey===a.taggroupkey&&-1===this.forbiddenTags.indexOf(a.key)&&-1===this.tagsKeys.indexOf(a.key)?(this.tagsKeys.push(a.key),this.tags.push(angular.extend({$selected:!0},a)),!0):!1},a.prototype.removeTag=function(a){return delete this.tags[a]},a.prototype.isEmpty=function(){return 0===this.tags.length},a.prototype.length=function(){return this.tags.length},a.prototype.addAllFromNodes=function(a,b,c){var d,e,f;if(null!==a&&a.length>0)for(d=0;d<a.length;++d)e=a[d],e.$data&&e.$data.tags&&("ALL"===this.className||this.className===e.$className)&&(f=e.$data.tags,this.addAll(f,b,c));return this.tags},a.prototype.addAll=function(a,b,c){var d;for(b===!0&&this.clear(),d=0;d<a.length;d++)this.addTag(a[d]);return c===!0&&this.tags.sort(function(a,b){return a.key>b.key?1:a.key<b.key?-1:0}),this.tags},a.prototype.selectAll=function(){this.tags.forEach(function(a){a.$selected=!0})},a.prototype.deselectAll=function(){this.tags.forEach(function(a){a.$selected=!1})},a.prototype.invertSelection=function(){this.tags.forEach(function(a){a.$selected=!a.$selected})},a.prototype.allSelected=function(){return this.tags.every(function(a,b,c){return a.$selected?void 0:!1}),!0},a.prototype.allDeselected=function(){return this.tags.every(function(a,b,c){return a.$selected?!1:void 0}),!0},a.prototype.getSelectedTags=function(){var a=[];return this.tags.forEach(function(b){b.$selected===!0&&a.push(b)}),a},a.prototype.getDeselectedTags=function(){var a=[];return this.tags.forEach(function(b){b.$selected===!1&&a.push(b)}),a},a.prototype.getSelectedKeys=function(){var a=[];return this.tags.forEach(function(b){b.$selected===!0&&a.push(b.key)}),a},a.prototype.getDeselectedKeys=function(){var a=[];return this.tags.forEach(function(b){b.$selected===!1&&a.push(b.key)}),a},a}]),angular.module("de.cismet.uim2020-html5-demonstrator.types",[]),angular.module("").run(["$templateCache",function(a){"use strict";a.put("templates/aggregation-table-directive.html",'<table ng-table=aggregationTableController.tableData class="table table-condensed table-bordered table-striped" show-filter=false><colgroup><col width="20%"><col width="20%"><col width="20%"><col width="20%"><col width="20%"><tr ng-repeat="value in $data track by value.pollutantkey"><td title="\'Parameter\'" data-sortable="\'name\'">{{value.name}}<td title="\'Maximalwert\'">{{value.maxvalue}}<td title="\'gemessen am\'">{{aggregationTableController.parseDate(value.maxdate) | date:\'dd.MM.yyyy\'}}<td title="\'Minimalwert\'">{{value.minvalue}}<td title="\'gemessen am\'">{{aggregationTableController.parseDate(value.mindate) | date:\'dd.MM.yyyy\'}}</table>'),a.put("templates/external-datasource-modal.html",'<div class=modal-header><h3 class=modal-title id=modal-title>Datenimport</h3></div><div class=modal-body id=modal-body><form name=importForm><div class="form-group row"><div class=col-md-12><p>Unterstütztes Format: ESRI Shapefile (.SHP, .DBF) in ZIP Archiv.</p></div></div><div class="form-group row"><div class=col-md-12><div class=input-group><label class=input-group-btn><span class="btn btn-default">Datei auswählen: <input type=file style="display: none" id=importFiles required ng-model=importController.importFile ng-disabled="importController.importInProgress || importController.importCompleted" ngf-select ngf-model-invalid=errorFile ngf-max-size=importController.maxFilesize ngf-multiple=false ngf-pattern="\'.zip\'" name=importFile></span></label><input class=form-control readonly ng-model=importController.importFile.name></div></div></div><div class="form-group row"><div class=col-xs-10><div class=form-check><label class=form-check-label><input type=checkbox class=form-check-input ng-disabled=true> Diese Datei allen anderen Nutzern zur Verfügung stellen</label></div></div></div><div class="form-group row"><div class=col-md-12><p><i ng-show=importForm.importFile.$error.maxSize>Die Datei ist zu groß: {{errorFile.size / 1000000|number:1}}MB. Maximale Dateigröße: {{importController.maxFilesize}}.</i></p><uib-progressbar class=progress-striped ng-class={active:importController.importInProgress} max=200 value=importController.importProgress type=primary></uib-progressbar></div></div></form></div><div class=modal-footer><button class="btn btn-default pull-left" type=button ng-disabled="!importForm.$valid || importController.importInProgress" ng-show=!importController.importCompleted ng-click=importController.import()>Importieren</button> <button class="btn btn-default pull-left" type=button ng-show=importController.importCompleted ng-click=importController.close()>Schliessen</button> <button class="btn btn-default pull-left" type=button ng-disabled=importController.importInProgress ng-click=importController.cancel()>Abbrechen</button></div>'),a.put("templates/external-datasources.html",'<div class=popover tabindex=-1 style=min-width:500px ng-controller="externalDatasourcesController as externalDatasourcesController" id=externalDatasourcesPopover name=externalDatasourcesPopover><div class=arrow></div><h1 class=popover-title><button type=button class=close ng-click=$hide()><span class="fa fa-close"></span></button> <big><strong>Externe Datenquellen</strong></big></h1><div class=popover-content><uib-accordion close-others=false><div uib-accordion-group ng-init="globalDatasourcesOpen = true" is-open=globalDatasourcesOpen ng-class="{\'text-muted\': isDisabled}"><uib-accordion-heading><div uib-accordion-header style=margin:0px;padding:8px;background-color:#c6e1ec;color:#3d7489>Vorkonfigurierte globale Datenquellen <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': globalDatasourcesOpen, \'glyphicon-chevron-up\': !globalDatasourcesOpen}"></i></div></uib-accordion-heading><div class=checkbox style=width:100%;clear:right ng-repeat="globalDatasource in externalDatasourcesController.globalDatasources"><label class=form-check-label><input class=form-check-input type=checkbox name={{globalDatasource.name}} ng-checked="globalDatasource.$layer && globalDatasource.$layer.$selected" ng-click=externalDatasourcesController.toggleGlobalDatasourceSelection(globalDatasource) ng-disabled=true> {{globalDatasource.name}}</label></div></div><div uib-accordion-group ng-init="localDatasourcesOpen = true" is-open=localDatasourcesOpen><uib-accordion-heading><div uib-accordion-header style=margin:0px;padding:8px;background-color:#c6e1ec;color:#3d7489>Eigene lokale Datenquellen <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': localDatasourcesOpen, \'glyphicon-chevron-up\': !localDatasourcesOpen}"></i></div></uib-accordion-heading><div class=checkbox style=width:100%;clear:right ng-repeat="localDatasource in externalDatasourcesController.localDatasources"><label class=form-check-label><input class=form-check-input type=checkbox name={{localDatasource.name}} ng-checked="localDatasource.$layer && localDatasource.$layer.$selected" ng-click=externalDatasourcesController.toggleLocalDatasourceSelection(localDatasource)> {{localDatasource.name}}</label><a class="btn btn-icon pull-right" title="Lokale Datenquelle entfernen" ng-click=externalDatasourcesController.removeLocalDatasource(localDatasource)><span class="fa fa-minus-circle pull-right" style=color:red></span></a></div><a class="btn btn-icon pull-right" title="Neue lokale Datenquelle hinzufügen" ng-click=externalDatasourcesController.addLocalDatasource()><span class="fa fa-plus-circle" style=color:green></span></a></div></uib-accordion></div><div class=panel-footer><button type=button class="btn btn-default" ng-click=$hide()>Schliessen</button></div></div>'),a.put("templates/search-progress-modal.html",'<div class=modal-header><center><h4>Bitte warten Sie, die Suche wird durchgeführt.</h4></center></div><div class=modal-body><div class=row><div class=col-lg-12><uib-progressbar class="progress-striped active" max=100 value=status.progress.current type={{status.type}}></uib-progressbar></div></div><div class=row><div class=col-lg-12><span><i>{{status.message}}</i></span></div></div></div><div class=modal-footer></div>'),a.put("templates/wizard-step-tpl.html",'<section ng-show=selected ng-class="{current: selected, done: completed}" class=step><div class="panel panel-primary"><div class=panel-heading><h1 class=panel-title>{{wzTitle}}</h1></div><div class=panel-body><div ng-transclude></div></div><div class="panel-footer clearfix"><button type=button class="btn btn-primary pull-right" wz-next ng-disabled=!wzData.canProceed>{{wzData.proceedButtonText}}</button> <span class=pull-right>&nbsp;</span> <button type=button class="btn btn-default pull-right" wz-previous ng-disabled=!wzData.canGoBack>Zurück</button></div></div></section>'),a.put("templates/wizard-tpl.html",'<div><div class=steps ng-transclude></div><ul class="steps-indicator steps-{{getEnabledSteps().length}}" ng-if=!hideIndicators><li ng-class="{default: !step.completed && !step.selected, \r\n                  current: step.selected && !step.completed, \r\n                  done: step.completed && !step.selected, \r\n                  editing: step.selected && step.completed}" ng-repeat="step in getEnabledSteps()"><a ng-click=goTo(step)>{{step.title || step.wzTitle}}</a></li></ul></div>')}]);
//# sourceMappingURL=uim2020-html5-demonstrator.min.js.map