var app=angular.module("de.cismet.uim2020-html5-demonstrator",["de.cismet.uim2020-html5-demonstrator.controllers","de.cismet.uim2020-html5-demonstrator.directives","de.cismet.uim2020-html5-demonstrator.services","de.cismet.uim2020-html5-demonstrator.filters","ngResource","ngAnimate","ngSanitize","ngCookies","ui.bootstrap","ui.bootstrap.modal","ui.router","ui.router.modal","ct.ui.router.extras.sticky","ct.ui.router.extras.dsr","ct.ui.router.extras.previous","leaflet-directive","ngTable","angularjs-dropdown-multiselect","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.popover","mgcrea.ngStrap.modal","mgo-angular-wizard","ngFileUpload"]);app.config(["$logProvider","$stateProvider","$urlRouterProvider",function(a,b,c){"use strict";a.debugEnabled(!1);var d;d=function(a){return console.log("resolve entity "+a.id+"@"+a["class"]),{"class":a["class"],id:a.id}},c.otherwise("/search/map"),b.state("main",{"abstract":!0,sticky:!0,url:"",views:{main:{templateUrl:"views/main.html",controller:"mainController",controllerAs:"mainController"}},deepStateRedirect:{"default":{state:"main.search"}}}),b.state("main.authentication",{url:"/login",data:{roles:["User"]},views:{"authentication@main":{templateUrl:"views/authentication/login.html",controller:"authenticationController",controllerAs:"authenticationController"}}}),b.state("main.search",{url:"/search",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.search.map",params:{zoom:"15"}}},views:{"search@main":{templateUrl:"views/search/index.html",controller:"searchController",controllerAs:"searchController"},"search-toolbar@main.search":{templateUrl:"views/search/toolbar.html",controller:["$scope",function(a){a.name="main.search.toolbar",this.name="this.main.search.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.search.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},sticky:!0,views:{"search-map@main.search":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}}}),b.state("main.search.list",{url:"/list",data:{roles:["User"]},sticky:!0,views:{"search-list@main.search":{templateUrl:"views/search/list.html",controller:"listController",controllerAs:"listController"}}}),b.state("main.analysis",{url:"/analysis",data:{roles:["User"]},sticky:!0,deepStateRedirect:{"default":{state:"main.analysis.map",params:{zoom:"14"}}},views:{"analysis@main":{templateUrl:"views/analysis/index.html",controller:"analysisController",controllerAs:"analysisController"},"analysis-toolbar@main.analysis":{templateUrl:"views/analysis/toolbar.html",controller:["$scope",function(a){a.name="main.analysis.toolbar",this.name="this.main.analysis.toolbar"}],controllerAs:"toolbarController"}}}),b.state("main.analysis.map",{url:"/map?{center:int}&{zoom:int}",data:{roles:["User"]},views:{"analysis-map@main.analysis":{templateUrl:"views/shared/map.html",controller:"mapController",controllerAs:"mapController"}},onEnter:function(){},onExit:function(){}}),b.state("main.protocol",{url:"/protocol",data:{roles:["User"]},sticky:!0,deepStateRedirect:!0,templateUrl:"views/protocol/index.html",controller:["$scope",function(a){console.log("main.protocol created"),a.name="main.protocol",this.name="this.main.protocol"}],controllerAs:"protocolController",views:{"protocol@main":{templateUrl:"views/protocol/index.html"}}}),b.state("modal",{"abstract":!0}),b.state("modal.entity",{url:"/entity/{class:string}/{id:int}",data:{roles:["User"]},sticky:!1,backdrop:"static",templateUrl:"views/entity/modal.html",controller:"entityController",controllerAs:"entityController",modal:!0,resolve:{entity:["$stateParams",d],entityModalInvoker:["$previousState",function(a){return a.memo("entityModalInvoker"),a.get("entityModalInvoker")}]}}),b.state("modal.export",{url:"/export",data:{roles:["User"]},sticky:!1,templateUrl:"views/export/modal.html",controller:"exportController",controllerAs:"exportController",modal:!0})}]),app.run(["$rootScope","$state","$stateParams","$previousState","configurationService","authenticationService",function(a,b,c,d,e,f){"use strict";a.$state=b,a.$stateParams=c,f.resolveIdentity(!1).then(function(){console.log("app.run:: user autenticated from session cookie:"+f.isAuthenticated())}),a.$on("$stateChangeStart",function(a,c,g,h,i){"main.authentication"!==c.name?e.developmentMode||f.isAuthenticated()?""===h.name&&"modal"===c.name.split(".").slice(0,1).pop()&&(a.preventDefault(),b.go("main.search.map",void 0,{location:!1}).then(function(){b.go(c,g)})):(console.warn("user not logged in, toState:"+c.name+", fromState:"+h.name),a.preventDefault(),d.memo("authentication"),b.go("main.authentication")):d.memo("authentication")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers",[]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("analysisController",["$timeout","$scope","$state","dataService","sharedDatamodel","sharedControllers","leafletData",function(a,b,c,d,e,f,g){"use strict";var h;h=this,console.log("analysisController instance created"),h.mode="map",h.clearAnalysisNodes=function(){e.analysisNodes.length=0,f.analysisMapController.clearNodes()},b.$on("$stateChangeSuccess",function(d){c.includes("main.analysis")&&!c.is("main.analysis")&&(h.mode=c.current.name.split(".").slice(1,3).pop(),"map"===h.mode&&g.getMap("analysis-map").then(function(c){a(function(){c&&c._container.parentElement&&(c._container.parentElement.offsetHeight>0&&c._container.parentElement.offsetWidth>0?(b.mapHeight=c._container.parentElement.offsetHeight,b.mapWidth=c._container.parentElement.offsetWidth,c.invalidateSize(!1)):c.invalidateSize(!1))},100)}))})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("appController",["$state","$previousState","configurationService","sharedDatamodel","authenticationService",function(a,b,c,d,e){"use strict";var f;f=this,f.status=d.status,f.selectedSearchThemes=d.selectedSearchThemes,f.selectedSearchPollutants=d.selectedSearchPollutants,f.resultNodes=d.resultNodes,f.signOut=function(){e.clearIdentity(),a.go("main.authentication"),b.memo("authentication")}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("authenticationController",["$scope","$state","$previousState","configurationService","authenticationService",function(a,b,c,d,e){"use strict";var f;f=this,a.errorStatusCode=-1,a.errorStatusMessage=null,f.signIn=function(f,g){a.errorStatusCode=-1,a.errorStatusMessage=null;var h=e.authenticate(f,d.authentication.domain,g);h.then(function(a){console.log('authenticationController::authenticationSuccess: user "'+a.user+'" successfully authenticated'),c.get("authentication")&&c.get("authentication").state&&"main.authentication"!==c.get("authentication").state.name?c.go("authentication"):b.go("main.search.map")},function(b){a.errorStatusCode=b.status,a.errorStatusMessage=b.statusText,a.password=null,-1===a.errorStatusCode&&(a.errorStatusCode=503),a.errorStatusMessage&&null!==a.errorStatusMessage||(a.errorStatusMessage="Verbindung zum Anmeldserver nicht möglich"),console.error('authenticationController::authenticationError: user "'+f+'" could not be authenticated: '+a.errorStatusMessage)})},f.signOut=function(){a.errorStatusCode=-1,a.errorStatusMessage=null,a.username=null,a.password=null,e.clearIdentity(),b.go("main.authentication"),c.memo("authentication")},console.log("authenticationController instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("entityController",["$scope","$state","$stateParams","$previousState","$uibModalInstance","entity","entityModalInvoker",function(a,b,c,d,e,f,g){"use strict";a["class"]=c["class"],a.id=c.id,a.entity=f,console.log("entityController created"),e.result["finally"](function(){console.log(d.get("entityModalInvoker").state),d.get("entityModalInvoker")&&d.get("entityModalInvoker").state?(console.log("entityController::close goto $previousState "+d.get("entityModalInvoker").state.name),d.go("entityModalInvoker")):(console.log("entityController::close goto default main.search.map"),b.go("main.search.map"))}),a.close=function(){console.log("entityController::close"),e.dismiss("close")},a.$on("$stateChangeStart",function(a,b){b.$$state().includes["modal.entity"]?console.log("entityController::$stateChangeStart: ignore "+b):console.log("entityController::$stateChangeStart: $uibModalInstance.close")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("exportController",["$scope","$state","$stateParams","$previousState","$uibModalInstance","entity","entityModalInvoker",function(a,b,c,d,e,f,g){"use strict";var h;h=this,a.wizard={},a.wizard.uploadchoice=!1,a.wizard.enterValidators=[],a.wizard.exitValidators=[],a.wizard.currentStep="",a.wizard.canProceed=!0,a.wizard.canGoBack=!1,a.wizard.hasError=!1,a.wizard.proceedButtonText="Weiter",a.wizard.isFinishStep=function(){return"Summary"===a.wizard.currentStep},a.wizard.isFirstStep=function(){return"Dataset Description"===a.wizard.currentStep},a.$watch("wizard.currentStep",function(b){b?(a.wizard.isFinishStep()?a.wizard.proceedButtonText="Fertig":a.wizard.proceedButtonText="Weiter",a.wizard.canGoBack=!a.wizard.isFirstStep()):a.wizard.proceedButtonText="Weiter"}),h.finishedWizard=function(){e.dismiss("close")},e.result["finally"](function(){b.go("main.analysis.map")}),a.close=function(){e.dismiss("close")},a.$on("$stateChangeStart",function(a,b){b.$$state().includes["modal.export"]?console.log("exportController::$stateChangeStart: ignore "+b):(console.log("exportController::$stateChangeStart: $uibModalInstance.close"),e.dismiss("close"))})}]),angular.module("de.cismet.sip-html5-resource-registration.controllers").controller("de.cismet.sip-html5-resource-registration.controllers.odRegistrationController",["$scope","$modal","$location","AppConfig","de.cismet.sip-html5-resource-registration.services.dataset","de.cismet.sip-html5-resource-registration.services.TagGroupService","de.cismet.sip-html5-resource-registration.services.searchService",function(a,b,c,d,e,f,g){"use strict";var h,i;i=void 0,h=this,h.dataset=e,h.config=d,h.groupBy=function(a){return a.name.indexOf(",")>-1?a.name.split(",",1)[0]:a.name.split(" ",1)[0]},h.checkLink=function(b){if(b){var c,e,f;e=function(b){b&&b.$collection&&b.$collection.length>0?(i='This dataset is already registered in the SWITCH-ON Spatial Information Platform under the name </strong>"'+b.$collection[0].name+'"</strong>. Click <a href="'+d.byod.baseUrl+"/#/resource/"+b.$collection[0].id+'" title="'+b.$collection[0].name+'" target="_blank">here</a> to view the dataset meta-data.',a.message.text=i,a.message.icon="fa-warning",a.message.type="info",a.wizard.hasError="datasetContentlocation"):("datasetContentlocation"===a.wizard.hasError&&(a.wizard.hasError=null),i=void 0)},f=function(a){console.error("search error: "+a),i=void 0},c=g.search(b).$promise.then(e,f)}i=void 0},h.selectKeywords=function(){b.open({animation:!0,templateUrl:"templates/keywordSelection.html",controller:"de.cismet.sip-html5-resource-registration.controllers.keywordsController",controllerAs:"keywordsController",keyboard:"true",size:"lg",scope:a})},h.gotoUploadTool=function(){var a=h.config.uploadtool.baseUrl+"?datasetname="+h.dataset.name;c.url(a)},h.checkUploadName=function(){return e.name?!0:(a.message.text="Please enter the name / title of the dataset before uploading ",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetUploadchoiceName",!1)},a.tags["function"]=f.getTagList("function"),a.tags["content type"]=f.getTagList("content type"),a.tags["keywords - X-CUAHSI"]=f.getTagList("keywords - X-CUAHSI"),a.wizard.enterValidators["Dataset Description"]=function(b){return b.valid===!0&&(a.message.text="Please provide some general information about the new dataset such as name, description, a (download) link and keywords.",a.message.icon="fa-info-circle",a.message.type="success"),b.valid},a.wizard.exitValidators["Dataset Description"]=function(b){b.valid=!0;var c=a.tags["content type"].every(function(a){return h.dataset.representation[0]&&h.dataset.representation[0].contenttype&&a.name===h.dataset.representation[0].contenttype.name?(h.dataset.representation[0].contenttype=a,!1):!0}),d=a.tags["function"].every(function(a){return h.dataset.representation[0]&&h.dataset.representation[0]["function"]&&a.name===h.dataset.representation[0]["function"].name?(h.dataset.representation[0]["function"]=a,!1):!0});return e.name?void 0===e.$uploaded?(a.message.text="Please chose wheter you want to upload a new dataset or to provide a link to anexisting dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetUploadchoice",b.valid=!1):d?(a.message.text="Please select a valid function (e.g. download) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0]["function"]?a.odRegistrationForm.datasetContentlocation.$error.url?(a.message.text="The link to the dataset you have provided is not a valid <a href='https://en.wikipedia.org/wiki/Uniform_Resource_Locator#Syntax' target='_blank' title='Uniform Resource Locator'>URL</a> .",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0].contentlocation?i?(a.message.text=i,a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):c?(a.message.text="Please select a valid content type (e.g. ESRI Shapefile) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):e.representation[0].contenttype?e.description?h.dataset.tags&&0!==h.dataset.tags.length||(a.message.text="Please assign at least one keyword to the Dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetTags",b.valid=!1):(a.message.text="Please provide a description of the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetDescription",b.valid=!1):(a.message.text="Please select a valid content type (e.g. ESRI Shapefile) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please provide link to the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please select a function (e.g. download) of the link.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetContentlocation",b.valid=!1):(a.message.text="Please enter the name / title of the dataset.",a.message.icon="fa-warning",a.message.type="warning",a.wizard.hasError="datasetName",b.valid=!1),b.valid===!0&&(a.wizard.hasError=null),b.valid}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("externalDatasourcesController",["$scope","$uibModal","dataService","sharedDatamodel","sharedControllers",function(a,b,c,d,e){"use strict";var f,g;f=this,g=e.analysisMapController,d.globalDatasources&&0!==d.globalDatasources.length||(c.getGlobalDatasources().$resolved?f.globalDatasources=c.getGlobalDatasources():c.getGlobalDatasources().$promise.then(function(a){f.globalDatasources=a,f.globalDatasources.$resolved=!0})),f.localDatasources=d.localDatasources,f.toggleGlobalDatasourceSelection=function(a){a.$layer||(a.$layer={$selected:!0}),a.$layer.$selected===!0?a.$layer.$selected=!1:a.$layer.$selected=!0},f.addLocalDatasource=function(){b.open({animation:!1,templateUrl:"templates/external-datasource-modal.html",controller:"importController",controllerAs:"importController",resolve:{localDatasource:function(){return{}}}});a.$hide()},f.removeLocalDatasource=function(a){var b=f.localDatasources.indexOf(a);b>-1?(a.$layer.$selected===!0&&f.toggleLocalDatasourceSelection(a),f.localDatasources.splice(b,1)):console.warn("externalDatasourcesController::removeLocalDatasource: unkwon datasource?!")},f.toggleLocalDatasourceSelection=function(a){a.$layer.$selected===!0?(a.$layer.$selected=!1,g.removeOverlay(a.$layer)):(a.$layer.$selected=!0,g.addOverlay(a.$layer))}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("importController",["$scope","$uibModalInstance","dataService","featureRendererService","sharedDatamodel","sharedControllers","localDatasource",function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;h=this,i=f.analysisMapController,h.importFile=null,h.maxFilesize="10MB",h.importProgress=0,h.importInProgress=!1,h.importCompleted=!1,h.importError=!1,j=function(a){var b=new FileReader;g.name=a.name.split(".").slice(0,1).pop(),g.fileName=a.name,b.onloadstart=function(){h.importInProgress=!0,console.log("onloadstart -> importController.importInProgress:"+h.importInProgress),2!==b.readyState||b.error},b.onprogress=function(a){h.importInProgress=!0;var b,c;a.lengthComputable?(b=event.total,c=event.loaded,h.importProgress=Math.min(100,parseInt(100*c/b))):h.importProgress=100},b.onloadend=function(b){var c,d;c=b.target.result,d=b.target.error,d?(console.error("File could not be read! Code "+d.code),h.importProgress=0,h.importInProgress=!1,h.importError=!0):(h.importProgress=100,console.log("onloadend -> importController.onloadend: "+h.importProgress),k(c,a.name))},b.readAsArrayBuffer(a)},k=function(a){var b;shp(a).then(function(a){console.log("importController::convertToLayer: processing "+a.features.length+"' GeoJson Features"),b=d.createOverlayLayer(g,a,function(a,b){b===a?h.importProgress=100+Math.min(100,parseInt(100*b/a)):h.importProgress=200,200===h.importProgress&&(h.importInProgress=!1,h.importCompleted=!0)}),e.localDatasources.push(g),i.addOverlay(b)})},h["import"]=function(){null!==h.importFile?j(h.importFile):b.dismiss("cancel")},h.cancel=function(){b.dismiss("cancel")},h.close=function(){b.close(g)}}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("listController",["$scope","configurationService","sharedDatamodel","NgTableParams",function(a,b,c,d){"use strict";var e,f;e=this,e.mode=a.mainController.mode,e.resultNodes=c.resultNodes,e.analysisNodes=c.analysisNodes,"search"===e.mode?e.nodes=e.resultNodes:"analysis"===e.mode&&(e.nodes=e.analysisNodes),e.tableColumns=[{field:"classKey",title:"Thema",show:!1,groupable:"classKey"},{field:"name",title:"Name",sortable:"name",show:!0},{field:"description",title:"Beschreibung",show:!0}],f={sorting:{name:"asc"},count:500},e.tableData=new d(f,{dataset:e.nodes,counts:[]}),a.$on("searchSuccess()",function(a){e.tableData.reload()}),a.$parent.listController=e,console.log("new listController instance created from "+a.name)}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mainController",["$scope","$state","$previousState","sharedDatamodel","sharedControllers",function(a,b,c,d,e){"use strict";var f;f=this,console.log("mainController::main instance created"),f.mode=b.current.name.split(".").slice(1,2).pop(),f.removeAnalysisNode=function(a){var b=d.analysisNodes.indexOf(a);-1!==b?(d.analysisNodes.splice(d.analysisNodes.indexOf(a),1),e.analysisMapController&&e.analysisMapController.removeNode(a)):console.warn("mainController::removeAnalysisNode: node '"+a.name+"' no in list of analysis nodes!")},f.addAnalysisNode=function(a){var b=d.analysisNodes.indexOf(a);if(-1!==b)console.warn("mainController::addAnalysisNode: node '"+a.name+"' already in list of analysis nodes!");else{var c=angular.copy(a);c.$feature=null,d.analysisNodes.push(c),e.analysisMapController&&e.analysisMapController.addNode(c)}},a.$on("$stateChangeSuccess",function(a){if(b.includes("main")&&!b.is("main")){f.mode=b.current.name.split(".").slice(1,2).pop();var d=c.get();d&&d.state&&d.state.name?f.previousStateName=d.state.name:f.previousStateName=void 0}else console.log("mainController::ingoring stateChange '"+b.name+"'")})}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("mapController",["$scope","$state","$stateParams","leafletData","configurationService","sharedDatamodel","sharedControllers","featureRendererService",function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;k=this,k.mode=a.mainController.mode,j=k.mode+"-map",l=e.map,n=new L.FeatureGroup,n.$name="Suchgeometrien",n.$key="searchGeometries",x=null,s=[],p=angular.copy(l.defaults),q=angular.copy(l.maxBounds),v=angular.copy(l.maxBounds),r=angular.copy(l.basemaps),t=angular.copy(l.layerControlOptions),u=angular.copy(l.drawOptions),A=angular.copy(l.fitBoundsOptions),B=null,"search"===k.mode?(k.nodes=f.resultNodes,g.searchMapController=k,s.push({groupName:e.map.layerGroupMappings.gazetteer,expanded:!1,layers:{}}),s.push(angular.copy(l.nodeOverlays)),z=1,o=new L.Control.Draw({draw:u,edit:!1,remove:!1})):"analysis"===k.mode&&(k.nodes=f.analysisNodes,g.analysisMapController=k,s.push(angular.copy(l.nodeOverlays)),s.push({groupName:e.map.layerGroupMappings.external,expanded:!1,layers:{}}),z=0),y={},y.basemap_at=L.stamp(r[0].layers[l.layerMappings.basemap_at]),y.arcgisonline_com=L.stamp(r[0].layers[l.layerMappings.arcgisonline_com]),y.opentopomap_org=L.stamp(r[0].layers[l.layerMappings.opentopomap_org]),y.openstreetmap_org=L.stamp(r[0].layers[l.layerMappings.openstreetmap_org]),y.BORIS_SITE=L.stamp(s[z].layers[l.layerMappings.BORIS_SITE]),y.EPRTR_INSTALLATION=L.stamp(s[z].layers[l.layerMappings.EPRTR_INSTALLATION]),y.MOSS=L.stamp(s[z].layers[l.layerMappings.MOSS]),y.WAGW_STATION=L.stamp(s[z].layers[l.layerMappings.WAGW_STATION]),y.WAOW_STATION=L.stamp(s[z].layers[l.layerMappings.WAOW_STATION]),angular.merge(a,{layers:{},defaults:p,center:q,maxBounds:v,controls:{scale:!0},tileLayer:""}),m=L.Control.styledLayerControl(r,s,t),w=function(a,b){"search"===k.mode?(n.clearLayers(),null!==a&&(a.$name=b,a.$key="searchGeometry",n.addLayer(a),l.options.centerOnSearchGeometry&&d.getMap(j).then(function(a){a.fitBounds(n.getBounds(),{animate:!0,pan:{animate:!0,duration:.6},zoom:{animate:!0},maxZoom:l.options.preserveZoomOnCenter?a.getZoom():null})}),a.once("click",function(a){w(null)}))):console.warn("mapController:: cannot add search geomatry to analysis map!")},k.getSearchWktString=function(){var a,b;return a=1===n.getLayers().length?n.getLayers()[0]:new L.rectangle(i.getBounds()),b=(new Wkt.Wkt).fromObject(a),b.write()},k.unSelectOverlayByKey=function(a){a&&y[a]&&m._Layers[y[a]]?k.unSelectOverlayByKey(m._Layers[y[a]]):console.warn("mapController::unSelectOverlayByKey: unknown key '"+a+"'")},k.unSelectOverlay=function(a){m.unSelectLayer(a)},k.selectOverlayByKey=function(a){a&&y[a]&&m._Layers[y[a]]?k.selectOverlay(m._Layers[y[a]]):console.warn("mapController::selectOverlayByKey: unknown key '"+a+"'")},k.selectOverlay=function(a){m.selectLayer(a),i.fitBounds(a.getBounds(),{animate:!0,pan:{animate:!0,duration:.6},zoom:{animate:!0},maxZoom:null})},k.removeOverlayByKey=function(a){a&&y[a]&&m._Layers[y[a]]?k.removeOverlay(m._Layers[y[a]]):console.warn("mapController::removeOverlayByKey: unknown key '"+a+"'")},k.removeOverlay=function(a){k.unSelectOverlay(a),m.removeLayer(a)},k.addOverlay=function(a){if("analysis"===k.mode)if(a.$key&&a.$name){y[a.$key]=L.stamp(a);var b=a.$groupName?a.$groupName:l.layerGroupMappings.external;m.addOverlay(a,a.$name,{groupName:b}),k.selectOverlay(a)}else console.warn("mapController:: cannot add overlay layer without $name and $key property!");else console.warn("mapController:: cannot add overlay to search map!")},k.gotoNode=function(a){var b;null!==B&&B.$feature&&(b=h.getIconForNode(B),B.$feature.setIcon(b)),a.$feature?(B=a,b=h.getHighlightIconForNode(B),B.$feature.setIcon(b),i.setView(B.$feature.getLatLng(),14)):B=null},k.addNode=function(a){"analysis"===k.mode?k.setNodes([a]):console.warn("mapController:: cannot add Node on search map!")},k.removeNode=function(a){var b,c,d;"analysis"===k.mode?a&&a.$feature&&a.$feature.$groupKey?(b=a.$feature,d=y[b.$groupKey],d&&m._layers[d]&&m._layers[d].layer?(c=m._layers[d].layer,c.removeLayer(b),a.$feature=null):console.warn("mapController::removeNode unsupported theme (feature group) '"+b.$groupKey+"'")):console.warn("mapController:: cannot remove Node '"+a.name+"': $feature is missing!"):console.warn("mapController:: cannot remove  Node on search map!")},k.clearNodes=function(){var a,b;a=[y.BORIS_SITE,y.EPRTR_INSTALLATION,y.MOSS,y.WAGW_STATION,y.WAOW_STATION],a.forEach(function(a){m._layers[a]&&m._layers[a].layer&&(b=m._layers[a].layer,b.clearLayers())})},k.setNodes=function(a,b,c){var d,e,f,g,j,l;if(c||(c="search"===k.mode?!0:!1),b||(b="search"===k.mode?!0:!1),c&&k.clearNodes(),null!==a&&a.length>0){d=h.createNodeFeatureGroups(a);for(g in d)j=y[g],j&&m._layers[j]&&m._layers[j].layer?(e=d[g],f=m._layers[j].layer,e.forEach(function(a){a.addTo(f)}),m.selectLayer(f),b&&(l=l?l.extend(f.getBounds()):f.getBounds())):console.warn("mapController::setNodes unsupported theme (feature group) '"+g+"'"),l&&i.fitBounds(l,A)}},k.setGazetteerLocation=function(a){"search"===k.mode?(console.log("mapController::setGazetteerLocation: "+a.name),null!==a?(null!==x&&(m.removeLayer(x),i.removeLayer(x),x=null),x=h.createGazetteerLocationLayer(a),y.gazetteer=L.stamp(x),null!==x?(m.addOverlay(x,x.$name,{groupName:l.layerGroupMappings.gazetteer}),m.selectLayer(x),i.fitBounds(x.getBounds(),A)):k.setGazetteerLocation(null)):null!==x&&(m.removeLayer(x),i.removeLayer(x),x=null)):console.warn("mapController:: cannot set gazetteerLocation on analysis map!")},"search"===k.mode&&(a.$on("gotoLocation()",function(a){"search"===k.mode&&(console.log("mapController::gotoLocation("+f.selectedGazetteerLocation.name+")"),k.setGazetteerLocation(f.selectedGazetteerLocation))}),a.$on("searchSuccess()",function(a){w(null),f.selectedSearchLocation.id=0,f.resultNodes.length>0?k.setNodes(f.resultNodes):k.clearNodes()}),a.$on("searchError()",function(a){w(null),f.selectedSearchLocation.id=0,k.clearNodes()}),a.$on("setSearchLocation()",function(a){0===f.selectedSearchLocation.id&&(w(null),f.selectedSearchLocation.id=0)})),d.getMap(j).then(function(a){i=a,a.addLayer(n),"search"===k.mode&&(a.addControl(o),a.on("draw:created",function(a){w(a.layer,a.layerType),f.selectedSearchLocation.id=1}),a.on("draw:deleted",function(a){w(null),f.selectedSearchLocation.id=0})),a.addControl(m),a.setMaxBounds(v),a.setZoom(q.zoom),m.selectLayer(r[0].layers[l.defaultBasemapLayer]),a.on("layerremove",function(a){var b=a.layer;b.StyledLayerControl&&b.StyledLayerControl.removable&&m._layers[L.stamp(b)]&&m.removeLayer(b),console.log("mapController:: layer removed: "+b.$name+" ("+L.stamp(b)+")"),b&&b===x&&console.log("mapController::gazetteerLocationLayer removed")}),"analysis"===k.mode&&f.analysisNodes&&f.analysisNodes.length>0?k.setNodes(f.analysisNodes):"search"===k.mode&&f.resultNodes&&f.resultNodes.length>0&&(console.warn(f.resultNodes.length+" result nodes available before search map controler instance created: possible sticky state synchrnoisation problem!"),k.setNodes(f.resultNodes,!0,!0))}),a.$parent.mapController=k,console.log(a.mainController.mode+" map controller instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.controllers").controller("searchController",["$rootScope","$window","$timeout","$scope","$state","$uibModal","leafletData","configurationService","sharedDatamodel","sharedControllers","dataService","searchService",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m,n,o,p;m=this,m.mode="map",m.status=i.status,m.searchLocations=k.getSearchLocations(),m.selectedSearchLocation=i.selectedSearchLocation,m.searchLocationsSettings=angular.extend({},h.multiselect.settings,{showCheckAll:!1,showUncheckAll:!1,styleActive:!1,closeOnSelect:!0,scrollable:!1,displayProp:"name",idProp:"id",enableSearch:!1,smartButtonMaxItems:1,selectionLimit:1,externalIdProp:"id"}),m.selectedSearchLocationEvents={onItemSelect:function(a){0===a.id&&d.$broadcast("setSearchLocation()")}},m.searchThemes=k.getSearchThemes(),m.selectedSearchThemes=i.selectedSearchThemes,m.searchThemesSettings=angular.extend({},h.multiselect.settings,{smartButtonMaxItems:0,idProp:"className",smartButtonTextConverter:function(a,b){return 1===m.selectedSearchThemes.length?"1 Thema ausgewählt":""}}),m.searchThemesTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Themen auswählen",dynamicButtonTextSuffix:"Themen ausgewählt"}),k.getSearchPollutants().$resolved?m.searchPollutants=k.getSearchPollutants():k.getSearchPollutants().$promise.then(function(a){m.searchPollutants=a}),m.selectedSearchPollutants=i.selectedSearchPollutants,m.searchPollutantsSettings=angular.extend({},h.multiselect.settings,{scrollableHeight:"600px",scrollable:!0,displayProp:"pollutant_name",idProp:"pollutant_key",searchField:"pollutant_name",enableSearch:!0,showEnableSearchButton:!1,selectByGroups:["Metalle und Schwermetalle"]}),m.searchPollutantsTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Schadstoffe auswählen",dynamicButtonTextSuffix:"Schadstoffe ausgewählt"}),k.getGazetteerLocations().$resolved?m.gazetteerLocations=k.getGazetteerLocations():k.getGazetteerLocations().$promise.then(function(a){m.gazetteerLocations=a}),m.selectedGazetteerLocation=i.selectedGazetteerLocation,m.gazetteerLocationsSettings=angular.extend({},h.multiselect.settings,{styleActive:!1,closeOnSelect:!0,scrollableHeight:"600px",scrollable:!0,displayProp:"name",idProp:"$self",searchField:"name",enableSearch:!0,smartButtonMaxItems:1,selectionLimit:1,externalIdProp:""}),m.gazetteerLocationsTranslationTexts=angular.extend({},h.multiselect.translationTexts,{buttonDefaultText:"Ort auswählen"}),o=function(){var b;b=a.$new(!0),b.status=m.status,p=f.open({templateUrl:"templates/search-progress-modal.html",scope:b,size:"lg",backdrop:"static"}),p.opened.then(function(){"error"===m.status.type&&p.close()})},n=function(a,b,d){m.status.progress.max=100,-1===b&&"success"===d?(m.status.progress.current=a,95>a?(m.status.message="Die Suche im UIM2020-DI Indexdatenbestand wird durchgeführt",m.status.type="success"):(m.status.message="Die UIM2020-DI Server sind z.Z. ausgelastet, bitte warten Sie einen Augenblick.",m.status.type="warning")):a===b&&"success"===d?(a>0?(m.status.progress.current=100,m.status.message="Suche erfolgreich, "+(1===a?"eine Messstelle":a+" Messstellen")+" im UIM2020-DI Indexdatenbestand gefunden.",m.status.type="success"):(m.status.progress.current=100,m.status.message="Es wurden keine zu den Suchkriterien passenden Messstellen im UIM2020-DI Indexdatenbestand gefunden",m.status.type="warning"),p&&c(function(){p.close()},500)):"error"===d&&(m.status.progress.current=100,m.status.message="Die Suche konnte aufgrund eines Server-Fehlers nicht durchgeführt werden.",m.status.type="danger",c(function(){p&&p.close(m.status.message)},2e3))},m.gotoLocation=function(){"map"!==m.mode&&e.go("^.map"),d.$broadcast("gotoLocation()")},m.search=function(a){var b,c,e,f,g;b=j.searchMapController.getSearchWktString(),c=[],e=[],f=500,g=0,i.selectedSearchThemes.forEach(function(a){c.push(a.id)}),i.selectedSearchPollutants.forEach(function(a){e.push(a.id)}),o(),l.defaultSearch(b,c,e,f,g,n).$promise.then(function(a){i.resultNodes.length=0,a.$collection&&a.$collection.length>0&&i.resultNodes.push.apply(i.resultNodes,a.$collection),d.$broadcast("searchSuccess()")},function(a){i.resultNodes.length=0,d.$broadcast("searchError()")})},d.$on("$stateChangeSuccess",function(a){e.includes("main.search")&&!e.is("main.search")&&(m.mode=e.current.name.split(".").slice(1,3).pop(),"map"===m.mode&&g.getMap("search-map").then(function(a){c(function(){a&&a._container.parentElement&&(a._container.parentElement.offsetHeight>0&&a._container.parentElement.offsetWidth?(d.mapHeight=a._container.parentElement.offsetHeight,d.mapWidth=a._container.parentElement.offsetWidth,a.invalidateSize(!1)):a.invalidateSize(!1))},100)}))}),console.log("searchController instance created")}]),angular.module("de.cismet.uim2020-html5-demonstrator.directives",[]),
angular.module("de.cismet.uim2020-html5-demonstrator.directives").directive("ngSize",["$rootScope",function(a){"use strict";return{restrict:"A",controller:["$scope",function(a){a.size={}}],link:function(b,c){var d,e;a.ngSizeDimensions=angular.isArray(a.ngSizeDimensions)?a.ngSizeDimensions:[],a.ngSizeWatch=angular.isArray(a.ngSizeWatch)?a.ngSizeWatch:[],d=function(){angular.forEach(a.ngSizeWatch,function(b,c){(a.ngSizeDimensions[c][0]!==b.offsetWidth||a.ngSizeDimensions[c][1]!==b.offsetHeight)&&(a.ngSizeDimensions[c]=[b.offsetWidth,b.offsetHeight],a.$broadcast("size::changed",c))})},e=!1,angular.forEach(a.ngSizeWatch,function(a,b){a===c[0]&&(e=b)}),e===!1&&(a.ngSizeWatch.push(c[0]),a.ngSizeDimensions.push([c[0].offsetWidth,c[0].offsetHeight]),e=a.ngSizeWatch.length-1),b.$on("size::changed",function(c,d){d===e&&(b.size||(b.size={}),b.size.width=a.ngSizeDimensions[d][0],b.size.height=a.ngSizeDimensions[d][1],console.log("width: "+b.size.width),console.log("height: "+b.size.height))}),window.ngSizeHandler||(window.ngSizeHandler=setInterval(d,10)),angular.element(window).on("resize",d)}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.filters",[]),angular.module("de.cismet.uim2020-html5-demonstrator.filters").filter("descriptionFilter",function(){"use strict";return function(a){var b="keine Beschreibung verfügbar";return a.literatur||a.institut?a.literatur?(b=a.literatur,a.institut&&(b+=" ("+a.institut+")")):b=a.institut:a.naceclass||a.erasid?b=a.naceclass?a.naceclass:a.erasid:a.zustaendigestelle||a.bundesland?a.zustaendigestelle?(b=a.zustaendigestelle,a.bundesland&&a.bundesland!==a.zustaendigestelle&&(b+=" ("+a.bundesland+")")):b=a.bundesland:(a.labno||a.sampleid)&&(b=a.labNo?"Labornummer: "+a.labNo:a.sampleid),b}}),angular.module("de.cismet.uim2020-html5-demonstrator.filters").filter("textLengthFilter",function(){"use strict";var a,b;return a=/[-\/\\^$*+?.()|[\]{}]/g,b=function(b,c){return new RegExp("["+b.replace(a,"\\$&")+"]",c)},function(a,c,d,e,f,g){var h,i,j,k,l,m,n;if(!a||void 0===c||null===c)return null;if(c>=a.length)m=a;else if(h=void 0===d||null===d?!1:d,k=void 0===e||null===e?"[...]":e,i=void 0===f||null===f?!1:f,j=void 0===g||null===g?".!?;:":g,i&&0===c)l=a.match(b(j,"")),m=l?l.index>=a.length-1?a:a.substr(0,l.index+1)+" "+k:k;else{if(m=a.substr(0,c-k.length),i){for(n=b(j,"g"),l=0;null!==n.exec(m.substr(0,m.length-1));)l=n.lastIndex;l>0&&(m=m.substr(0,l+1)+" ")}h?m+=k:(l=m.match(/\s+\w*$/),l?m=m.substr(0,l.index+1)+k:m+=k)}return m}}),angular.module("de.cismet.uim2020-html5-demonstrator.services",["ngResource"]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("authenticationService",["$q","$http","$cookieStore","configurationService","base64",function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l,m,n,o,p;return f=null,h=function(){return angular.isDefined(f)},i=function(){return void 0!==f&&null!==f&&void 0!==f.authorizationToken&&null!==f.authorizationToken},j=function(a){return i()&&f.userGroups?-1!==f.userGroups.indexOf(a):!1},k=function(a){if(!i()||!f.userGroups)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},l=function(a,b,c){var d;return d="Basic "+e.encode(a+"@"+b+":"+c),g(d)},g=function(e){var g,h,i;return f=null,h=d.cidsRestApi.host+"/users",g=a.defer(),i={method:"GET",url:h,headers:{Authorization:e,Accept:"application/json"}},b(i).then(function(a){f=a.data,f.authorizationToken=e,c.put(d.authentication.cookie,f),g.resolve(f)},function(a){g.reject(a)}),g.promise},m=function(b){return i()?a.when(f):(f=c.get(d.authentication.cookie),i()?b?g(f.authorizationToken):a.when(f):(console.warn("no stored session cookie available, user has to re-authenticate"),a.when(f)))},n=function(){return f},o=function(){return i()?f.authorizationToken:null},p=function(){f=null,c.put(d.authentication.cookie,null)},m(),{isIdentityResolved:h,isAuthenticated:i,isInRole:j,isInAnyRole:k,authenticate:l,resolveIdentity:m,getIdentity:n,getAuthorizationToken:o,clearIdentity:p}}]).factory("base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&console.error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!==g&&(h+=String.fromCharCode(d)),64!==j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("autorisationService",["$rootScope","$state","$previousState","authenticationService",function(a,b,c,d){"use strict";return{authorize:function(){return d.identity().then(function(){var e=d.isAuthenticated();a.toState.data.roles&&a.toState.data.roles.length>0&&!d.isInAnyRole(a.toState.data.roles)&&(e?(console.warn("user is not in any role"),c.memo("autorisation")):(c.memo("autorisation"),b.go("signin")))})}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("configurationService",[function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m;a=this,a.developmentMode=!0,a.cidsRestApi={},a.cidsRestApi.host="http://localhost:8890",a.cidsRestApi.domain="UDM2020-DI",a.cidsRestApi.defaultRestApiSearch="de.cismet.cids.custom.udm2020di.serversearch.DefaultRestApiSearch",a.authentication={},a.authentication.domain=a.cidsRestApi.domain,a.authentication.username="uba",a.authentication.password="",a.authentication.cookie="de.cismet.uim2020-html5-demonstrator.identity",a.searchService={},a.searchService.defautLimit=10,a.searchService.maxLimit=50,a.searchService.host=a.cidsRestApi.host,a.map={},a.map.options={},a.map.options.centerOnSearchGeometry=!0,a.map.options.preserveZoomOnCenter=!1,a.map.home={},a.map.home.lat=47.61,a.map.home.lng=13.782778,a.map.home.zoom=7,a.map.maxBounds=new L.latLngBounds(L.latLng(46.372299,9.53079),L.latLng(49.02071,17.160749)),a.map.defaults={minZoom:7,maxBounds:a.map.maxBounds,controls:{layers:{visible:!1,position:"bottomright",collapsed:!0}}},a.map.layerControlOptions={container_width:"300px",container_height:"600px",container_maxHeight:"600px",exclusive:!1},a.map.layerGroupMappings={basemaps:"Grundkarten",nodes:"Themen",gazetteer:"Aktueller Ort",external:"Externe Datenquellen"},a.map.layerMappings={basemap_at:"Verwaltungsgrundkarte",arcgisonline_com:"ArcGIS Topographic",opentopomap_org:"OpenTopoMap",openstreetmap_org:"OpenStreetMap",BORIS_SITE:"Bodenmesstellen",EPRTR_INSTALLATION:"ePRTR Einrichtungen",MOSS:"Moose",WAOW_STATION:"Wassermesstellen",WAGW_STATION:"Grundwassermesstellen"},a.map.defaultBasemapLayer="Verwaltungsgrundkarte",b=new L.tileLayer("http://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",{subdomains:["maps","maps1","maps2","maps3","maps4"],attribution:'&copy; <a href="http://basemap.at">Basemap.at</a>, <a href="http://www.isticktoit.net">isticktoit.net</a>'}),b.$name=a.map.layerMappings.basemap_at,b.$key="basemap_at",b.$groupName="Grundkarten",b.$groupKey="basemaps",c=L.esri.basemapLayer("Topographic"),c.$name=a.map.layerMappings.arcgisonline_com,c.$key="arcgisonline_com",c.$groupName=a.map.layerGroupMappings.basemaps,c.$groupKey="basemaps",e=new L.TileLayer("http://opentopomap.org/{z}/{x}/{y}.png",{attribution:'Map data © <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a> contributors, SRTM | Rendering: © <a href="http://opentopomap.org" target="_blank">OpenTopoMap</a> (CC-BY-SA)'}),e.$name=a.map.layerMappings.opentopomap_org,e.$key="opentopomap_org",e.$groupName=a.map.layerGroupMappings.basemaps,e.$groupKey="basemaps",d=new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data © <a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a> contributors'}),d.$name=a.map.layerMappings.openstreetmap_org,d.$key="openstreetmap_org",d.$groupName=a.map.layerGroupMappings.basemaps,d.$groupKey="basemaps",k={},k[a.map.layerMappings.basemap_at]=b,k[a.map.layerMappings.arcgisonline_com]=c,k[a.map.layerMappings.opentopomap_org]=e,k[a.map.layerMappings.openstreetmap_org]=d,a.map.basemaps=[{groupName:a.map.layerGroupMappings.basemaps,expanded:!0,layers:k}],f=new L.FeatureGroup,f.$name=a.map.layerMappings.BORIS_SITE,f.$key="BORIS_SITE",f.$groupName=a.map.layerGroupMappings.nodes,f.$groupKey="nodes",f.StyledLayerControl={removable:!1,visible:!1},g=new L.FeatureGroup,g.$name=a.map.layerMappings.EPRTR_INSTALLATION,g.$key="EPRTR_INSTALLATION",g.$groupName=a.map.layerGroupMappings.nodes,g.$groupKey="nodes",g.StyledLayerControl={removable:!1,visible:!1},h=new L.FeatureGroup,h.$name=a.map.layerMappings.MOSS,h.$key="MOSS",h.$groupName=a.map.layerGroupMappings.nodes,h.$groupKey="nodes",h.StyledLayerControl={removable:!1,visible:!1},i=new L.FeatureGroup,i.$name=a.map.layerMappings.WAGW_STATION,i.$key="WAGW_STATION",i.$groupName=a.map.layerGroupMappings.nodes,i.$groupKey="nodes",i.StyledLayerControl={removable:!1,visible:!1},j=new L.FeatureGroup,j.$name=a.map.layerMappings.WAOW_STATION,j.$key="WAOW_STATION",j.$groupName=a.map.layerGroupMappings.nodes,j.$groupKey="nodes",j.StyledLayerControl={removable:!1,visible:!1},l={},l[a.map.layerMappings.BORIS_SITE]=f,l[a.map.layerMappings.EPRTR_INSTALLATION]=g,l[a.map.layerMappings.MOSS]=h,l[a.map.layerMappings.WAGW_STATION]=i,l[a.map.layerMappings.WAOW_STATION]=j,a.map.nodeOverlays={groupName:a.map.layerGroupMappings.nodes,expanded:!0,layers:l},a.map.searchOverlays=[],angular.merge([],[{groupName:a.map.layerGroupMappings.gazetteer,expanded:!1,layers:{}}],m),a.map.analysisOverlays=angular.merge([],m,[{groupName:a.map.layerGroupMappings.external,expanded:!1,layers:{}}]),a.map.drawOptions={polyline:!1,polygon:{shapeOptions:{color:"#006d2c",clickable:!0},showArea:!0,metric:!0},rectangle:{shapeOptions:{color:"#006d2c",clickable:!0},metric:!0},circle:!1,marker:!1},a.map.fitBoundsOptions={animate:!0,pan:{animate:!0,duration:.6},zoom:{animate:!0},maxZoom:null},a.featureRenderer={},a.featureRenderer.gazetteerStyle={color:"#8856a7",fillColor:"#feb24c",fillOpacity:.3,fill:!0,weight:4,riseOnHover:!1,clickable:!1},a.featureRenderer.defaultStyle={color:"#0000FF",fill:!1,weight:2,riseOnHover:!0,clickable:!1},a.featureRenderer.highlightStyle={fillOpacity:.4,fill:!0,fillColor:"#1589FF",riseOnHover:!0,clickable:!1},a.featureRenderer.icons={},a.featureRenderer.icons.BORIS_SITE=L.icon({iconUrl:"icons/showel_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.WAGW_STATION=L.icon({iconUrl:"icons/wagw_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.WAOW_STATION=L.icon({iconUrl:"icons/waow_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.EPRTR_INSTALLATION=L.icon({iconUrl:"icons/factory_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.icons.MOSS=L.icon({iconUrl:"icons/grass_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0]}),a.featureRenderer.highlightIcons={},a.featureRenderer.highlightIcons.BORIS_SITE=L.icon({iconUrl:"icons/showel_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.WAGW_STATION=L.icon({iconUrl:"icons/wagw_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.WAOW_STATION=L.icon({iconUrl:"icons/waow_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.EPRTR_INSTALLATION=L.icon({iconUrl:"icons/factory_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.highlightIcons.MOSS=L.icon({iconUrl:"icons/grass_16.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,0],shadowUrl:"icons/icon_shadow.png",shadowSize:[24,24],shadowAnchor:[12,12]}),a.featureRenderer.layergroupNames={},a.featureRenderer.layergroupNames.MOSS="Moose",a.featureRenderer.layergroupNames.EPRTR_INSTALLATION="ePRTR ePRTR Einrichtungen",a.featureRenderer.layergroupNames.WAOW_STATION="Wassermesstellen",a.featureRenderer.layergroupNames.WAGW_STATION="Grundwassermesstellen",a.featureRenderer.layergroupNames.BORIS_SITE="Bodenmesstellen",a.multiselect={},a.multiselect.settings={styleActive:!0,displayProp:"name",idProp:"id",buttonClasses:"btn btn-default navbar-btn cs-search-multiselect"},a.multiselect.translationTexts={checkAll:"Alles auswählen",uncheckAll:"Alles abwählen",enableSearch:"Suche aktivieren",disableSearch:"Suche deaktivieren",selectionCount:" ausgewählt",selectionOf:" von ",searchPlaceholder:"Suche...",buttonDefaultText:"Auswählen",dynamicButtonTextSuffix:"ausgewählt",selectGroup:"Alle auswählen: "}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("dataService",["$resource",function(a){"use strict";var b,c,d,e,f;return f=[{name:"Gesamter Kartenausschnitt",id:0,geometry:null},{name:"Boundingbox Auswahl",id:1,geometry:null,disabled:!0}],b={searchThemes:"data/searchThemes.json",searchPollutants:"data/searchPollutants.json",gazetteerLocations:"data/gazetteerLocations.json",filterPollutants:"data/filterPollutants.json",mockNodes:"data/resultNodes.json",mockObjects:"data/resultObjects.json",globalDatasources:"data/globalDatasources.json"},c=[],d=function(d,e){var f;return c.hasOwnProperty(d)?(f=c[d],f.$resolved||console.warn("possible synchonisation problem for cached resource "+d),f):b.hasOwnProperty(d)?(f=a(b[d],{},{query:{method:"GET",params:{},isArray:e}}),c[d]=f.query(),c[d]):(console.warn("unknown static resource:"+d),null)},e=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a},{getSearchLocations:function(){return f},getSearchThemes:function(){return d("searchThemes",!0)},getSearchPollutants:function(){return d("searchPollutants",!0)},getGazetteerLocations:function(){return d("gazetteerLocations",!0)},getGlobalDatasources:function(){return d("globalDatasources",!0)},getMockNodes:function(){var a=d("mockNodes",!0);return a.$resolved&&e(a),a}}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("entitiyService",["$resource","$q","$interval","configurationService","authenticationService",function(a,b,c,d,e){"use strict";var f,g;f=d.cidsRestApi,g=a(f.host+"/"+f.domain+".:classname/:objId",{omitNullValues:!0,deduplicate:!0},{get:{method:"GET",isArray:!1,headers:{Authorization:e.getAuthorizationToken()}}})}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("featureRendererService",["configurationService",function(a){"use strict";var b,c,d,e,f,g,h,i;return b=a.featureRenderer,d=function(a,c){if(a.hasOwnProperty("cachedGeometry")){var d,e,f,g;if(a.cachedGeometry){g=b.icons[c],d=a.cachedGeometry,e=new Wkt.Wkt,e.read(d.substr(d.indexOf(";")+1));var h={icon:g,title:a.name};return f=e.toObject(h),f.bindPopup(a.name),f.$name=a.name,f.$key=a.objectKey,f.$groupKey=c,a.$feature=f,a.$icon=g.options.iconUrl,f}return console.warn("no cached geometry for node "+a.name+" ("+a.objectKey+")"),null}},e=function(a){var c,d,e,f;if(a.hasOwnProperty("area"))c=a.area.geo_field,e=!1;else{if(!a.hasOwnProperty("geometry"))return null;c=a.geometry.geo_field,e=!0}return d=new Wkt.Wkt,d.read(c.substr(c.indexOf(";")+1)),f=e===!0?d.toObject().getLayers()[0]:d.toObject(),f.setStyle(angular.copy(b.gazetteerStyle)),f.$name=a.name,f.$key="gazetteerLocation",f},f=function(a){var b,c,e,f,g,h;for(h=[],b=0;b<a.length;++b)c=a[b],e=c.classKey.split(".").slice(1,2).pop(),f=d(c,e),f&&(h.hasOwnProperty(e)?g=h[e]:(g=[],h[e]=g),g.push(f));return h},g=function(a,b,c){var d,e=0;return b.fileName=a.fileName,d=L.geoJson(b,{onEachFeature:function(a,d){a.properties&&d.bindPopup(Object.keys(a.properties).map(function(b){return b+": "+a.properties[b]}).join("<br />"),{maxHeight:200}),c&&c(b.features.length,e++)}}),d.$name=a.name,d.$key=a.fileName,d.$selected=!0,d.StyledLayerControl={removable:!0,visible:!1},a.$layer=d,d},h=function(a){var c,d;return c=a.classKey.split(".").slice(1,2).pop(),d=b.icons[c]},i=function(a){var c,d;return c=a.classKey.split(".").slice(1,2).pop(),d=b.highlightIcons[c]},c=function(a){var c,d,e,f;return e=null,!e&&a.spatialcoverage&&a.spatialcoverage.geo_field&&(c=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(c.substr(c.indexOf(";")+1)),f=Object.create(b.defaultStyle),a.name&&(f.title=a.name),e=d.toObject(f),e.setStyle(b.defaultStyle)),a&&a.$self&&"/switchon.resource"===a.$self.substr(0,18).toLowerCase()&&a.representation&&a.representation.every(function(b){var f,g;return b.name&&b.contentlocation&&b.type&&"aggregated data"===b.type.name&&b["function"]&&"service"===b["function"].name&&b.protocol&&("WWW:TILESERVER"===b.protocol.name?(e=L.tileLayer(b.contentlocation,{tms:"true",zIndex:999}),e.getBounds=function(){return a.spatialcoverage&&a.spatialcoverage.geo_field?(c=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(c.substr(c.indexOf(";")+1)),d.toObject().getBounds()):void 0},e.setOpacity(0)):"OGC:WMS-1.1.1-http-get-capabilities"===b.protocol.name&&(f=b.contentlocation,g=b.name,e=L.tileLayer.wms(f,{layers:g,format:"image/png",transparent:!0,version:"1.1.1",zIndex:999}),e.getBounds=function(){return a.spatialcoverage&&a.spatialcoverage.geo_field?(c=a.spatialcoverage.geo_field,d=new Wkt.Wkt,d.read(c.substr(c.indexOf(";")+1)),d.toObject().getBounds()):void 0},e.setOpacity(0))),null===e}),e},{createNodeFeatureGroups:f,createGazetteerLocationLayer:e,createOverlayLayer:g,getIconForNode:h,getHighlightIconForNode:i,defaultStyle:b.defaultStyle,highlightStyle:b.highlightStyle}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("geoTools",["leafletData",function(a){"use strict";var b,c,d,e,f,g,h;return b=new Wkt.Wkt,c={color:"#0000FF",fillOpacity:.3,weight:2,fill:!0,fillColor:"#1589FF",riseOnHover:!0,clickable:!0},e={polyline:!1,polygon:{shapeOptions:c,showArea:!0,metric:!0,allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!</strong>"}},rectangle:{shapeOptions:c,metric:!0},circle:!1,marker:!1},d={polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:!1},f=function(a){if(a.spatialcoverage&&a.spatialcoverage.geo_field){var d=a.spatialcoverage.geo_field;-1!==d.indexOf(";")?b.read(d.substr(d.indexOf(";")+1)):b.read(d);var e=b.toObject(c);return e.setStyle(c),e}return void 0},g=function(a,b){if(b&&a.spatialcoverage){var c="SRID=4326;"+b;a.spatialcoverage.geo_field=c}},h=function(b){a.getMap(b).then(function(a){setTimeout(function(){a.invalidateSize()},50)})},{wicket:b,defaultStyle:c,defaultDrawOptions:e,noDrawOptions:d,readSpatialCoverage:f,writeSpatialCoverage:g,fireResize:h}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("objectRendererService",["configurationService",function(a){"use strict";var b;return b=function(a){return a},{getObjectIcon:b}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").factory("searchService",["$resource","$q","$interval","configurationService","authenticationService",function(a,b,c,d,e){"use strict";var f,g;return f=d.cidsRestApi,g=function(g,h,i,j,k,l){var m,n,o,p,q,r,s,t;return n=angular.noop,(l||n)(0,-1,"success"),t=1,s=c(function(){(l||n)(t,-1,"success"),t++},100,100),m=b.defer(),o={list:[{key:"geometry",value:g},{key:"themes",value:h},{key:"pollutants",value:i}]},k&&j&&j>0&&k>0&&k%j!==0&&(k=0),p={$promise:m.promise,$resolved:!1,$offset:k,$limit:j,$length:0},q=a(f.host+"/searches/"+f.domain+"."+f.defaultRestApiSearch+"/results",{limit:100,offset:0,omitNullValues:!0,deduplicate:!0},{search:{method:"POST",params:{limit:"@limit",offset:"@offset"},isArray:!1,headers:{Authorization:e.getAuthorizationToken()}}}),r=q.search({limit:j,offset:k},o),r.$promise.then(function(a){var b,e,f,g,h,i;for(b in a)if(a.hasOwnProperty(b)&&("$"!==b.charAt(0)||"$"!==b.charAt(1))&&(p[b]=a[b],"$collection"===b&&angular.isArray(p.$collection)))for(f=p.$collection.length,e=0;f>e;e++)if(g=p.$collection[e],i=g.classKey.split(".").slice(1,2).pop(),d.featureRenderer.icons[i]&&(g.$icon=d.featureRenderer.icons[i].options.iconUrl),d.featureRenderer.layergroupNames[i]&&(i=d.featureRenderer.layergroupNames[i]),g.className=i,g.lightweightJson)try{h=angular.fromJson(g.lightweightJson),g.$data=h,delete p.$collection[e].lightweightJson,g.className=h.className?h.className:i}catch(j){console.error(j.message)}p.$length=a.$collection?a.$collection.length:0,p.$total&&0!==p.$total||(p.$total=p.length),m.resolve(p),c.cancel(s),(l||n)(p.$length,p.$length,"success")},function(a){console.log("searchService::defaultSearchFunction()->error()"),p.$error="cannot search for resources",p.$response=a,p.$resolved=!0,m.reject(p),c.cancel(s),(l||n)(1,1,"error")}),p},{defaultSearch:g}}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("sharedControllers",[function(){"use strict";this.appController=void 0,this.mainController=void 0,this.analysisMapController=void 0,this.searchController=void 0,this.analysisMapController=void 0,this.searchMapController=void 0,this.searchListController=void 0,this.protocolController=void 0}]),angular.module("de.cismet.uim2020-html5-demonstrator.services").service("sharedDatamodel",[function(){"use strict";this.identity=null,this.selectedSearchThemes=[],this.selectedSearchPollutants=[],this.selectedGazetteerLocation={},this.selectedSearchLocation={id:0},this.resultNodes=[],this.analysisNodes=[],this.selectedGlobalDatasources=[],this.localDatasources=[],this.selectedLocalDatasources=[],this.status={},this.status.type="success",this.status.message="UIM-2020 Demonstrator Datenintegration",this.status.progress={},this.status.progress.current=0,this.status.progress.max=0}]),angular.module("").run(["$templateCache",function(a){"use strict";a.put("templates/external-datasource-modal.html",'<div class=modal-header><h3 class=modal-title id=modal-title>Datenimport</h3></div><div class=modal-body id=modal-body><form name=importForm><div class="form-group row"><div class=col-md-12><p>Unterstütztes Format: ESRI Shapefile (.SHP, .DBF) in ZIP Archiv.</p></div></div><div class="form-group row"><div class=col-md-12><div class=input-group><label class=input-group-btn><span class="btn btn-default">Datei auswählen: <input type=file style="display: none" id=importFiles required ng-model=importController.importFile ng-disabled="importController.importInProgress || importController.importCompleted" ngf-select ngf-model-invalid=errorFile ngf-max-size=importController.maxFilesize ngf-multiple=false ngf-pattern="\'.zip\'" name=importFile></span></label><input class=form-control readonly ng-model=importController.importFile.name></div></div></div><div class="form-group row"><div class=col-xs-10><div class=form-check><label class=form-check-label><input type=checkbox class=form-check-input ng-disabled=true> Diese Datei allen anderen Nutzern zur Verfügung stellen</label></div></div></div><div class="form-group row"><div class=col-md-12><p><i ng-show=importForm.importFile.$error.maxSize>Die Datei ist zu groß: {{errorFile.size / 1000000|number:1}}MB. Maximale Dateigröße: {{importController.maxFilesize}}.</i></p><uib-progressbar class=progress-striped ng-class={active:importController.importInProgress} max=200 value=importController.importProgress type=primary></uib-progressbar></div></div></form></div><div class=modal-footer><button class="btn btn-default pull-left" type=button ng-disabled="!importForm.$valid || importController.importInProgress" ng-show=!importController.importCompleted ng-click=importController.import()>Importieren</button> <button class="btn btn-default pull-left" type=button ng-show=importController.importCompleted ng-click=importController.close()>Schliessen</button> <button class="btn btn-default pull-left" type=button ng-disabled=importController.importInProgress ng-click=importController.cancel()>Abbrechen</button></div>'),a.put("templates/external-datasources.html",'<div class=popover tabindex=-1 style=min-width:500px ng-controller="externalDatasourcesController as externalDatasourcesController" id=externalDatasourcesPopover name=externalDatasourcesPopover><div class=arrow></div><h1 class=popover-title><button type=button class=close ng-click=$hide()><span class="fa fa-close"></span></button> <big><strong>Externe Datenquellen</strong></big></h1><div class=popover-content><uib-accordion close-others=false><div uib-accordion-group ng-init="globalDatasourcesOpen = true" is-open=globalDatasourcesOpen ng-class="{\'text-muted\': isDisabled}"><uib-accordion-heading><div uib-accordion-header style=margin:0px;padding:8px;background-color:#c6e1ec;color:#3d7489>Vorkonfigurierte globale Datenquellen <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': globalDatasourcesOpen, \'glyphicon-chevron-up\': !globalDatasourcesOpen}"></i></div></uib-accordion-heading><div class=checkbox style=width:100%;clear:right ng-repeat="globalDatasource in externalDatasourcesController.globalDatasources"><label class=form-check-label><input class=form-check-input type=checkbox name={{globalDatasource.name}} ng-checked="globalDatasource.$layer && globalDatasource.$layer.$selected" ng-click=externalDatasourcesController.toggleGlobalDatasourceSelection(globalDatasource) ng-disabled=true> {{globalDatasource.name}}</label></div></div><div uib-accordion-group ng-init="localDatasourcesOpen = true" is-open=localDatasourcesOpen><uib-accordion-heading><div uib-accordion-header style=margin:0px;padding:8px;background-color:#c6e1ec;color:#3d7489>Eigene lokale Datenquellen <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': localDatasourcesOpen, \'glyphicon-chevron-up\': !localDatasourcesOpen}"></i></div></uib-accordion-heading><div class=checkbox style=width:100%;clear:right ng-repeat="localDatasource in externalDatasourcesController.localDatasources"><label class=form-check-label><input class=form-check-input type=checkbox name={{localDatasource.name}} ng-checked="localDatasource.$layer && localDatasource.$layer.$selected" ng-click=externalDatasourcesController.toggleLocalDatasourceSelection(localDatasource)> {{localDatasource.name}}</label><a class="btn btn-icon pull-right" title="Lokale Datenquelle entfernen" ng-click=externalDatasourcesController.removeLocalDatasource(localDatasource)><span class="fa fa-minus-circle pull-right" style=color:red></span></a></div><a class="btn btn-icon pull-right" title="Neue lokale Datenquelle hinzufügen" ng-click=externalDatasourcesController.addLocalDatasource()><span class="fa fa-plus-circle" style=color:green></span></a></div></uib-accordion></div><div class=panel-footer><button type=button class="btn btn-default" ng-click=$hide()>Schliessen</button></div></div>'),a.put("templates/search-progress-modal.html",'<div class=modal-header><center><h4>Bitte warten Sie, die Suche wird durchgeführt.</h4></center></div><div class=modal-body><div class=row><div class=col-lg-12><uib-progressbar class="progress-striped active" max=100 value=status.progress.current type={{status.type}}></uib-progressbar></div></div><div class=row><div class=col-lg-12><span><i>{{status.message}}</i></span></div></div></div><div class=modal-footer></div>'),a.put("templates/wizard-step-tpl.html",'<section ng-show=selected ng-class="{current: selected, done: completed}" class=step><div class="panel panel-primary"><div class=panel-heading><h1 class=panel-title>{{wzTitle}}</h1></div><div class=panel-body><div ng-transclude></div></div><div class="panel-footer clearfix"><button type=button class="btn btn-primary pull-right" wz-next ng-disabled=!wzData.canProceed>{{wzData.proceedButtonText}}</button> <span class=pull-right>&nbsp;</span> <button type=button class="btn btn-default pull-right" wz-previous ng-disabled=!wzData.canGoBack>Zurück</button></div></div></section>'),a.put("templates/wizard-tpl.html",'<div><div class=steps ng-transclude></div><ul class="steps-indicator steps-{{getEnabledSteps().length}}" ng-if=!hideIndicators><li ng-class="{default: !step.completed && !step.selected, \r\n                  current: step.selected && !step.completed, \r\n                  done: step.completed && !step.selected, \r\n                  editing: step.selected && step.completed}" ng-repeat="step in getEnabledSteps()"><a ng-click=goTo(step)>{{step.title || step.wzTitle}}</a></li></ul></div>')}]);
//# sourceMappingURL=uim2020-html5-demonstrator.min.js.map